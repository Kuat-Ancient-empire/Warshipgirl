namespace = wsgranking
# 创建国家

country_event = {
    id = wsgranking.1919
    hide_window = yes
    is_triggered_only = yes
    fire_only_once = yes    

    # 只在有舰娘国家才执行
    trigger = {
        any_country = {
			is_wg_empire = yes
			is_ai = no
            NOT = { has_origin = origin_wg_shop }
		}
        NOT = { has_global_flag = pantsu_shop_created }
    }

    immediate = {
        create_species = {
			name = "NAME_pantsu_shop_species"
			class = "Warship_Girls"
			portrait = "Warship_girls"
			traits = random
			immortal = yes
			effect = { }
		}
		create_country = {
			name = "NAME_pantsu_shop"
			species = last_created_species
			type = pantsu_shop
			name_list = "WSG"
			# 旗子，让海豹自己改
			flag = {
				icon = {
					category = "wg_event_flags"
					file = "wge_flags_01.dds"
				}
				background= {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors={
					"blue"
					"black"
					"null"
					"null"
				}
			}
			ignore_initial_colony_error = yes
			effect = {
                set_country_flag = protected_from_queen_storm
				save_global_event_target_as = pantsu_shop_country
				# 加基地设计，创建恒星基地用
				create_ship_design = { design = "NAME_pantsu_shop_station" }
				add_ship_design = last_created_design
                set_country_flag = no_origin
				# 防止掠夺者打商店
                # 掠夺者打不过这个商店，让他们尽管送死好了
				# every_country = {
				# 	limit = { is_country_type = dormant_marauders }
				# 	set_faction_hostility = {
				# 		target = prev
				# 		set_hostile = no 
				# 		set_neutral = no
				# 		set_friendly = yes
				# 	}
                # }
                # 设置变量
                set_variable = { which = dark_matter_stock value = 200000 }
                set_variable = { which = living_metal_stock value = 200000 }
                set_variable = { which = zro_stock value = 200000 }
                set_variable = { which = nanite_stock value = 100000 }
                set_variable = { which = alpha_stock value = 100000 }
                set_variable = { which = se_stock value = 100000 }
                set_variable = { which = rings_stock value = 3 }
			}
		}
        set_global_flag = pantsu_shop_created
        every_playable_country = {
            limit = { is_wg_empire = yes }
            set_variable = {
                which = wg_shop_exchange_resource_max
                value = 10000
            }
        }
        random_system = {
            limit = {
                has_star_flag = can_spawn_boss_system
            }
            spawn_system = {
                min_jumps = 0
                max_jumps = 3
                hyperlane = yes
                initializer = "shop_system" 
            }
            event_target:pantsu_shop_system = {
                random_system_planet = {
                    create_pantsu_shop_guard_fleets = yes
                }
            }
        }
    }
    # save global event target 已经放进去了solar system initializer了，所以不用再save了
}

country_event = {
    id = wsgranking.810
    hide_window = yes
    is_triggered_only = yes
    fire_only_once = yes    

    trigger = {
        NOT = { has_global_flag = pantsu_shop_created }
    }

    immediate = {
        
    }
}

# 旧存档适配 （大概）
# 已经宣布了不适配旧存档所以大概不需要这个了
#event = {
#    id = wsgranking.810
#    hide_window = yes
#    fire_only_once = yes
#
#    trigger = {
#        NOT = { has_global_flag = pantsu_shop_created }
#    }
#
#    immediate = {
#        random_country = {
#            limit = { is_country_type = global_event }
#            country_event = { id = wsgranking.1919 }
#        }
#        # 旧存档如果已经有胖次科技直接联系
#        every_playable_country = {
#            limit = {
#                OR = {
#                    has_authority = auth_warshipgirls
#                    has_authority = auth_shenhai
#                }
#                has_technology = tech_wsg_pantsu
#                NOT = { has_communications = event_target:pantsu_shop_country }
#            }
#        }
#        set_country_flag = establish_communicate_in_normal
#        establish_communications_no_message = event_target:pantsu_shop_country
#        country_event = { id = wsgranking.1000 }
#    }
#}

# 初次联络事件
country_event = {
	id = wsgranking.994
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		from = {
			is_country_type = pantsu_shop
		}
		OR = {
            is_ai = no
			is_country_type = default
			is_country_type = default_ev
		}
	}

	immediate = {
		from = {
			establish_communications_no_message = root
		}
        if = {
            limit = { is_wg_empire = yes }
            change_variable = {
                which = wg_coffee_ticket
                value = 10
            }
            country_event = { id = wsgranking.1000 }
            country_event = { id = wsgranking.20001 }
        } else = {
            country_event = { id = wsgranking.997 }
        }
		
	}
}


# 有船路过胖次商店
# Scope = Ship
# From = System
# FromFrom = Country
ship_event = {
	id = wsgranking.996
	hide_window = yes
    is_triggered_only = yes

    trigger = {
        exists = event_target:pantsu_shop_country
        From = { has_star_flag = shop_system_home }
        FromFrom = { 
            is_default_country_wg = yes
            NOT = { has_communications = event_target:pantsu_shop_country }
        }
    }

    immediate = {
        owner = {
            if = { 
                limit = { 
                    OR = {
                        has_authority = auth_warshipgirls
                        has_authority = auth_shenhai
                    }
                    is_ai = no
                }
                # 防止事件重复发生
                set_country_flag = establish_communicate_in_normal
                establish_communications_no_message = event_target:pantsu_shop_country
                country_event = { id = wsgranking.1000 }
                country_event = { id = wsgranking.20001 }
            }
            else = {
                establish_communications_no_message = event_target:pantsu_shop_country
                country_event = { id = wsgranking.997 }
            }
        }
    }
}

# 普通国家遇到胖次商店
country_event = {
	id = wsgranking.997
	title = "action.11.name"
    desc = wsgranking.997.desc
    is_triggered_only = yes

    option = {
        name = WORRYING
    }

}

# 非正常原因与胖次商店取得联系
country_event = {
	id = wsgranking.998
	hide_window = yes
    is_triggered_only = yes
    trigger = {
        fromfrom = {
            is_country_type = pantsu_shop
        }
        NOT = { has_country_flag = establish_communicate_in_normal }
    }

    immediate = {
        country_event = { id = wsgranking.1000 }
    }

}

# 胖次科技研究后主动联络胖次商店
country_event = {
	id = wsgranking.999
	title = wsgranking.999.title
    desc = wsgranking.999.desc
    picture = GFX_evt_wg_ella

    fire_only_once = yes
    is_triggered_only = yes

    trigger = {
        OR = {
            has_authority = auth_warshipgirls
            has_authority = auth_shenhai
        }
        is_ai = no
        last_increased_tech = tech_wsg_pantsu
	    NOT = { has_communications = event_target:pantsu_shop_country }
		NOT = { has_origin = origin_wg_shop }
    }

    immediate = {
        # 防止事件重复发生
        set_country_flag = establish_communicate_in_normal
    }

    after = {
        establish_communications_no_message = event_target:pantsu_shop_country
        country_event = { id = wsgranking.1000 }
        country_event = { id = wsgranking.20001 }
    }

    option = {
        name = CURIOUS
    }
}

# （深海）胖次建筑建造后自动联系
planet_event = {
	id = wsgranking.995
	title = wsgranking.999.title
    desc = wsgranking.999.desc
    picture = GFX_evt_wg_ella

    fire_only_once = yes
    is_triggered_only = yes

    trigger = {
        owner = {
            has_authority = auth_shenhai
            is_ai = no
            NOT = { has_communications = event_target:pantsu_shop_country }
        }
        last_building_changed = building_sh_pantsu
    }

    immediate = {
        # 防止事件重复发生
        owner = { set_country_flag = establish_communicate_in_normal }
    }

    option = {
        name = CURIOUS
        hidden_effect = {
            owner = { 
                establish_communications_no_message = event_target:pantsu_shop_country
                country_event = { id = wsgranking.1000 }
                country_event = { id = wsgranking.20001 }
            }
        }
    }
}

country_event = {
	id = wsgranking.20001
	is_triggered_only = yes
	hide_window = yes
	trigger = {
        has_communications = event_target:pantsu_shop_country
        NOT = { has_country_flag = set_buff_limits }
	}
	immediate = {
        set_country_flag = set_buff_limits
		set_variable = {
			which = max_allowed_shop_buffs
			value = 2
		}
	}
}

country_event = {
	id = wsgranking.20002
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		last_increased_tech = tech_wg_buff_1
        NOT = { has_country_flag = gain_tech_wg_shop_buff_1 }
	}
	immediate = {
        set_country_flag = gain_tech_wg_shop_buff_1
		change_variable = {
			which = max_allowed_shop_buffs
			value = 1
		}
	}
}

country_event = {
	id = wsgranking.20003
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		last_increased_tech = tech_wg_buff_2
        NOT = { has_country_flag = gain_tech_wg_shop_buff_2 }
	}
	immediate = {
        set_country_flag = gain_tech_wg_shop_buff_2
		change_variable = {
			which = max_allowed_shop_buffs
			value = 1
		}
	}
}

#到期恢复商店BUFF上限
country_event = {
	id = wsgranking.20004
	is_triggered_only = yes
	hide_window = yes
	immediate = {
		change_variable = {
			which = max_allowed_shop_buffs
			value = 1
		}
	}
}

# 初次介绍
country_event = {
	id = wsgranking.1000
	title = pantsu_shop_name
	desc = wsgranking.1000.desc
    custom_gui = "enclave_caravaneer_window"
	diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
        # 有需求的话自己改名字
		room = Ella_room
	}

    immediate = {
        remove_country_flag = establish_communicate_in_normal
        
        add_research_option = tech_wsg_trading_pantsu
        add_tech_progress = {
            tech = tech_wsg_trading_pantsu
            progress = 0.25
        }
        country_event = { id = wsgranking.5005 days = 3600 random = 1000 }
    }

    # 进入一级菜单
	option = { 
        custom_gui = "enclave_caravaneer_option"
        trigger = { OR = {
            has_authority = auth_warshipgirls
            has_authority = auth_shenhai
        }}
		name = wsgranking.1000.a
		hidden_effect = {
			country_event = { id = wsgranking.1004 }
		}
	}

    # 退出
	option = { 
        custom_gui = "enclave_caravaneer_option"
        trigger = { OR = {
            has_authority = auth_warshipgirls
            has_authority = auth_shenhai
        }}
		name = wsgranking.1000.b
	}
    option = {
        name = OK
        trigger = { NOR = {
            has_authority = auth_warshipgirls
            has_authority = auth_shenhai
        }}		
    }
	
}

# 打开商店的主界面
country_event = {
	id = wsgranking.1001
	title = pantsu_shop_name
    custom_gui = "enclave_caravaneer_window"
    trigger = {
        OR = {
            has_authority = auth_shenhai
            has_authority = auth_warshipgirls
        }
        exists = event_target:pantsu_shop_country
        event_target:pantsu_shop_country = {
            NOT = { is_hostile = root }
        }
        NOT = { has_country_flag = pantsu_shop_cooldown }
        OR = { 
            #防止视窗多开
            NOT = { has_country_flag = engaged_with_pantsu_shop }
			pantsu_shop_active_diplo = no 
			from = { is_same_value = root } # returning from open sub-menu
		}
        from = { OR = {
            is_country_type = pantsu_shop
            is_same_value = root # returned from menu
        }}
        is_ai = no
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

    # 介绍1
	desc = { text = pantsu_shop_hello1 }

    # 介绍2
	desc = { text = pantsu_shop_hello2 }

    # 介绍3
	desc = { text = pantsu_shop_hello3 }

    desc = {
        exclusive_trigger = { has_country_flag = pantsu_shop_origin }
        text = origin_pantsu_shop_hello1
    }
    desc = {
        exclusive_trigger = { has_country_flag = pantsu_shop_origin }
        text = origin_pantsu_shop_hello2
    }
    desc = {
        exclusive_trigger = { has_country_flag = pantsu_shop_origin }
        text = origin_pantsu_shop_hello3
    }

    diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
		room = Ella_room
    }
    
    immediate = {
        set_country_flag = engaged_with_pantsu_shop
        if = {
            limit = { NOT = { has_country_flag = engaged_with_canteen }}
            random_list = {
                40 = {
                    country_event = { id = wsgranking.2030 days = 2 }#打开食堂
                }
                60 = {#不举办
                    set_timed_country_flag = { flag = engaged_with_canteen days = 180 }
                }
            }
        }
    }

    # 询问军阶点数。
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1001.a
        trigger = {
            NOT = { has_country_flag = pantsu_shop_origin }
        }
        response_text = wsgranking.1001.a.response
        is_dialog_only = yes
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1001.a
        trigger = {
            has_country_flag = pantsu_shop_origin
        }
        response_text = wsgranking.1001.a.response2
        is_dialog_only = yes
    }

    # 进入兑换。选项：兑换科技/兑换修正/兑换杂项资源。
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1001.b
        hidden_effect = {
            country_event = { id = wsgranking.1004 }
        }
    }
	option = { 
        custom_gui = "enclave_caravaneer_option"
        # 购买终极物品
		name = wsgranking.1004.e
		trigger = {
			has_country_flag = ultimate_items_unlocked
		}
        hidden_effect = {
            country_event = { id = wsgranking.9006 }
        }
    }

    # 退出
    option = { 
    custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
        remove_country_flag = engaged_with_pantsu_shop
    }
}
#冷却期间打开胖次商店
country_event = {
	id = wsgranking.1002
	title = pantsu_shop_name
    custom_gui = "enclave_caravaneer_window"
    trigger = {
        OR = {
            has_authority = auth_shenhai
            has_authority = auth_warshipgirls
        }
        exists = event_target:pantsu_shop_country
        has_country_flag = pantsu_shop_cooldown
        event_target:pantsu_shop_country = {
            NOT = { is_hostile = root }
        }
        OR = { 
            #防止视窗多开
			pantsu_shop_active_diplo = no 
			from = { is_same_value = root } # returning from open sub-menu
		}
        from = { OR = {
            is_country_type = pantsu_shop
            is_same_value = root # returned from menu
        }}
        is_ai = no
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

    # 介绍1
	desc = { text = pantsu_shop_cooldown_desc }

    diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
		room = Ella_room
	}

    # 退出
    option = { 
    custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
    }
}


# 非舰娘帝国点进胖次商店
country_event = {
    id = wsgranking.1101
	title = wsgranking.1101.title
    desc = wsgranking.1101.desc

    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
    is_triggered_only = yes

    picture_event_data = {
        room = Ella_room
    }
    
    trigger = {
        NOR = {
            has_authority = auth_shenhai
            has_authority = auth_warshipgirls
        }
        from = { is_country_type = pantsu_shop }
        NOT = { has_global_flag = pantsu_shop_disabled }
    }
    
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = OK
    }
}

# 敌对时联络
country_event = {
    id = wsgranking.1003
	title = pantsu_shop_name
    desc = wsgranking.1003.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
    is_triggered_only = yes
    picture_event_data = {
        room = Ella_room
    }
    
    trigger = {
        from = { is_country_type = pantsu_shop }
        OR = {
            has_authority = auth_shenhai
            has_authority = auth_warshipgirls
        }
        exists = event_target:pantsu_shop_country
        event_target:pantsu_shop_country = {
            is_hostile = ROOT
        }
        NOT = { has_active_event = { wsgranking.1003 }}
        OR = { # prevents diplo duplication
            NOT = { has_country_flag = engaged_with_pantsu_shop }
			pantsu_shop_active_diplo = no 
			from = { is_same_value = root } # returning from open sub-menu
		}
        is_ai = no
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

    immediate = {
        set_country_flag = engaged_with_pantsu_shop
    }
    after = {
        remove_country_flag = engaged_with_pantsu_shop
    }

    # 预留了一下恢复和平的选项
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1003.a
        trigger = {
            # 显示条件
        }
        allow = {
            # 允许选择的条件
        }
        set_faction_hostility = {
            target = from
            set_hostile = no 
            set_neutral = yes
            set_friendly = no
        }
    }

    # 退出
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
    }
    
}

# 一级界面 - 进入兑换。
country_event = {
	id = wsgranking.1004
	title = pantsu_shop_name
	desc = wsgranking.1004.desc
    desc = {
        exclusive_trigger = { has_country_flag = pantsu_shop_origin }
        text = wsgranking.1004.desc.b
    }
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
	is_triggered_only = yes

    trigger = {
        OR = { 
            #防止视窗多开
			pantsu_shop_active_diplo = no 
			from = { is_same_value = root } # returning from open sub-menu
        }
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

	picture_event_data = {
		room = Shop_room
	}

    option = { 
        custom_gui = "enclave_caravaneer_option"
        # 兑换科技
        name = wsgranking.1004.a
        # trigger = {
        #     OR = {
        #         has_technology = tech_wsg_203
        #         has_technology = tech_sh_Lweapon
        #     }
        # }
        hidden_effect = {
            country_event = { id = wsgranking.1005 }
        }
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        # 兑换修正
        name = wsgranking.1004.b
        hidden_effect = {
            #country_event = { id = wsgranking.1006 }
            country_event = { id = wsgranking.1007 }
        }
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        # 兑换杂项资源
        name = wsgranking.1004.c
        hidden_effect = {
            #country_event = { id = wsgranking.1008 }
            country_event = { id = wsgranking.1009 }
        }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        # 买戒指
        name = wsgranking.1004.d
        hidden_effect = {
            country_event = { id = wsgranking.1010 }
        }
	}
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1004.f
        hidden_effect = {
            country_event = { id = wg_coffee.16 }
        }
    }

    option = {
        custom_gui = "enclave_caravaneer_option"
        # 取消所有货物协议
        name = end_all_contract
        trigger = {
            has_any_pantsu_shop_contract = yes
        }
        hidden_effect = { 
            country_event = { id = wsgranking.1017 }
            remove_country_flag = engaged_with_pantsu_shop
        }
    }

    # 返回主选单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_main
        hidden_effect = {
            country_event = { id = wsgranking.1001 }
        }
    }

    # 退出
    option = { custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
        remove_country_flag = engaged_with_pantsu_shop
    }
}

# 二级菜单 - 兑换科技
country_event = {
	id = wsgranking.1005
	title = pantsu_shop_name
	desc = wsgranking.1005.desc
    desc = {
        exclusive_trigger = { has_country_flag = pantsu_shop_origin }
        text = wsgranking.1005.desc.b
    }
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
		room = Shop_room
    }
    
    trigger = {
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        custom_tooltip = "tech_wsg_rim99_desc"
        name = tech_wsg_rim99
        trigger = {
            has_authority = auth_warshipgirls
            OR = {
                has_technology = tech_exotic_gases
                has_technology = tech_mine_exotic_gases
            }
            NOR = {
                has_tech_option = tech_wsg_rim99
                has_technology = tech_wsg_rim99
            }
        }
        allow = {
            resource_stockpile_compare = { resource = sr_pantsu value >= 200 }
            resource_stockpile_compare = { resource = exotic_gases value >= 200 }
            custom_tooltip = {
				fail_text = too_low_rank_fail_25
				check_variable = { which = "rankpts" value >= 25 }
            }
            custom_tooltip = {
                NOT = { has_modifier = wg_modifier_weapon_payment }
                fail_text = tech_cooldown_desc
            }
        }
        add_resource = {
            sr_pantsu = -200
            exotic_gases = -200
        }
        give_technology = { tech = tech_wsg_rim99 }
        add_modifier = { modifier = wg_modifier_weapon_payment days = 90 }
        hidden_effect = { country_event = { id = wsgranking.1005 }}
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        custom_tooltip = "tech_wsg_nanana_sensor_desc"
        name = tech_wsg_nanana_sensor
        trigger = {
            OR = {
                has_authority = auth_warshipgirls
                has_authority = auth_shenhai
            }
            NOR = {
                has_tech_option = tech_wsg_nanana_sensor
                has_technology = tech_wsg_nanana_sensor
            }
        }
        allow = {
            resource_stockpile_compare = { resource = sr_pantsu value >= 200 }
            custom_tooltip = {
				fail_text = too_low_rank_fail_40
				check_variable = { which = "rankpts" value >= 40 }
            }
            custom_tooltip = {
                NOT = { has_modifier = wg_modifier_weapon_payment }
                fail_text = tech_cooldown_desc
            }
        }
        add_resource = {
            sr_pantsu = -200
        }
        give_technology = { tech = tech_wsg_nanana_sensor }
        add_modifier = { modifier = wg_modifier_weapon_payment days = 90 }
        hidden_effect = { country_event = { id = wsgranking.1005 }}
    }
	option = { 
        custom_gui = "enclave_caravaneer_option"
		custom_tooltip = "tech_pantsu_armor_tooltip"
        name = tech_pantsu_armor
        trigger = {
            NOR = {
                has_tech_option = tech_pantsu_armor
                has_technology = tech_pantsu_armor
            }
			has_origin = origin_wg_shop
        }
        allow = {
            has_technology = tech_ship_armor_3
            resource_stockpile_compare = { resource = sr_pantsu value >= 1000 }
            custom_tooltip = {
				fail_text = too_low_rank_fail_50
				check_variable = { which = "rankpts" value >= 50 }
            }
            custom_tooltip = {
                NOT = { has_modifier = wg_modifier_weapon_payment }
                fail_text = tech_cooldown_desc
            }
        }
        add_resource = {
            sr_pantsu = -1000
        }
        give_technology = { tech = tech_pantsu_armor }
        add_modifier = { modifier = wg_modifier_weapon_payment days = 90 }
        hidden_effect = { country_event = { id = wsgranking.1005 }}
    }
	option = { 
        custom_gui = "enclave_caravaneer_option"
		custom_tooltip = "wg_shop_pc_habitat_habitability_desc"
        name = wg_shop_pc_habitat_habitability
        trigger = {
            NOT = { has_modifier = wg_shop_pc_habitat_habitability }
			has_origin = origin_wg_shop
        }
        allow = {
            resource_stockpile_compare = { resource = sr_pantsu value >= 500 }
            custom_tooltip = {
				fail_text = too_low_rank_fail_50
				check_variable = { which = "rankpts" value >= 50 }
            }
            custom_tooltip = {
                NOT = { has_modifier = wg_modifier_weapon_payment }
                fail_text = tech_cooldown_desc
            }
        }
        add_resource = {
            sr_pantsu = -500
        }
        add_modifier = { modifier = wg_shop_pc_habitat_habitability }
        add_modifier = { modifier = wg_modifier_weapon_payment days = 90 }
        hidden_effect = { country_event = { id = wsgranking.1005 }}
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        custom_tooltip = "tech_wsg_pd127_desc"
        name = tech_wsg_pd127
        trigger = {
            has_authority = auth_warshipgirls
            NOR = {
                has_tech_option = tech_wsg_pd127
                has_technology = tech_wsg_pd127
            }
        }
        allow = {
            resource_stockpile_compare = { resource = sr_pantsu value >= 1000 }
            resource_stockpile_compare = { resource = rare_crystals value >= 500 }
            has_technology = tech_wsg_152
            custom_tooltip = {
				fail_text = too_low_rank_fail_50
				check_variable = { which = "rankpts" value >= 50 }
            }
            custom_tooltip = {
                NOT = { has_modifier = wg_modifier_weapon_payment }
                fail_text = tech_cooldown_desc
            }
        }
        add_resource = {
            sr_pantsu = -1000
            rare_crystals = -500
        }
        give_technology = { tech = tech_wsg_pd127 }
        add_modifier = { modifier = wg_modifier_weapon_payment days = 90 }
        hidden_effect = { country_event = { id = wsgranking.1005 }}
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        custom_tooltip = "tech_wsg_auto127_desc"
        name = tech_wsg_auto127
        trigger = {
            has_authority = auth_warshipgirls
            NOR = {
                has_tech_option = tech_wsg_auto127
                has_technology = tech_wsg_auto127
            }
        }
        allow = {
            resource_stockpile_compare = { resource = sr_pantsu value >= 1000 }
            resource_stockpile_compare = { resource = rare_crystals value >= 500 }
			has_technology = tech_wsg_152
            custom_tooltip = {
				fail_text = too_low_rank_fail_50
				check_variable = { which = "rankpts" value >= 50 }
            }
            custom_tooltip = {
                NOT = { has_modifier = wg_modifier_weapon_payment }
                fail_text = tech_cooldown_desc
            }
        }
        add_resource = {
            sr_pantsu = -1000
            rare_crystals = -500
        }
        give_technology = { tech = tech_wsg_auto127 }
        add_modifier = { modifier = wg_modifier_weapon_payment days = 90 }
        hidden_effect = { country_event = { id = wsgranking.1005 }}
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = tech_living_metal_bulge
        custom_tooltip = "tech_living_metal_bulge_desc"
        trigger = {
            has_authority = auth_warshipgirls
            NOR = {
                has_tech_option = tech_living_metal_bulge
                has_technology = tech_living_metal_bulge
            }
        }
        allow = {
            resource_stockpile_compare = { resource = sr_pantsu value >= 2000 }
            resource_stockpile_compare = { resource = alloys value >= 5000 }
            has_technology = tech_mine_living_metal
            if = {
                limit = { hidden_trigger = { has_ascension_perk = ap_mist }}
                has_technology = tech_wsg_ia
            } else_if = {
                limit = { hidden_trigger = { has_ascension_perk = ap_project_s }}
                has_technology = tech_wsg_s_ia
            }
            custom_tooltip = {
				fail_text = too_low_rank_fail_120
				check_variable = { which = "rankpts" value >= 120 }
            }
            custom_tooltip = {
                NOT = { has_modifier = wg_modifier_weapon_payment }
                fail_text = tech_cooldown_desc
            }
        }
        add_resource = {
            sr_pantsu = -2000
            alloys = -5000
        }
        give_technology = { tech = tech_living_metal_bulge }
        add_modifier = { modifier = wg_modifier_weapon_payment days = 90 }
        hidden_effect = { country_event = { id = wsgranking.1005 }}
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = tech_wsg_auto152
        custom_tooltip = "tech_wsg_auto152_desc"
        trigger = {
            has_authority = auth_warshipgirls
            NOR = {
                has_tech_option = tech_wsg_auto152
                has_technology = tech_wsg_auto152
            }
        }
        allow = {
            resource_stockpile_compare = { resource = sr_pantsu value >= 1500 }
            resource_stockpile_compare = { resource = alloys value >= 3000 }
            if = {
                limit = { hidden_trigger = { has_ascension_perk = ap_mist }}
                has_technology = tech_wsg_203
            } else_if = {
                limit = { hidden_trigger = { has_ascension_perk = ap_project_s }}
                has_technology = tech_wsg_weapon_S_300
            }
            custom_tooltip = {
				fail_text = too_low_rank_fail_70
				check_variable = { which = "rankpts" value >= 70 }
            }
            custom_tooltip = {
                NOT = { has_modifier = wg_modifier_weapon_payment }
                fail_text = tech_cooldown_desc
            }
        }
        add_resource = {
            sr_pantsu = -1500
            alloys = -3000
        }
        give_technology = { tech = tech_wsg_auto152 }
        add_modifier = { modifier = wg_modifier_weapon_payment days = 90 }
        hidden_effect = { country_event = { id = wsgranking.1005 }}
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = tech_wsg_203plasma
        custom_tooltip = "tech_wsg_203plasma_desc"
        trigger = {
            has_authority = auth_warshipgirls
            NOR = {
                has_tech_option = tech_wsg_203plasma
                has_technology = tech_wsg_203plasma
            }
        }
        allow = {
            resource_stockpile_compare = { resource = sr_pantsu value >= 2000 }
			if = {
                limit = { hidden_trigger = { has_ascension_perk = ap_mist }}
                has_technology = tech_wsg_203
            } else_if = {
                limit = { hidden_trigger = { has_ascension_perk = ap_project_s }}
                has_technology = tech_wsg_weapon_S_300
            }	
            custom_tooltip = {
				fail_text = too_low_rank_fail_90
				check_variable = { which = "rankpts" value >= 90 }
            }
            custom_tooltip = {
                NOT = { has_modifier = wg_modifier_weapon_payment }
                fail_text = tech_cooldown_desc
            }
        }
        add_resource = {
            sr_pantsu = -2000
        }
        give_technology = { tech = tech_wsg_203plasma }
        add_modifier = { modifier = wg_modifier_weapon_payment days = 120 }
        hidden_effect = { country_event = { id = wsgranking.1005 }}
    }
	option = {#审判 
		custom_gui = "enclave_caravaneer_option"
		custom_tooltip = tech_wg_doom_desc
        name = tech_wg_doom
        trigger = { 
            NOT = { has_technology = tech_wg_doom }
            NOR = {
                has_ethic = ethic_militarist
                has_ethic = ethic_fanatic_militarist
                has_ethic = ethic_fanatic_xenophobe
                has_ethic = ethic_xenophobe
            }
        }
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 90 }
				fail_text = too_low_rank_fail_90
			}
			custom_tooltip = {
                NOT = { has_modifier = wg_modifier_weapon_payment }
                fail_text = tech_cooldown_desc
            }
			has_technology = tech_missiles_3
            resource_stockpile_compare = { resource = energy value >= 6000 }
			resource_stockpile_compare = { resource = sr_pantsu value >= 1000 }
		}
        add_resource = { energy = -6000 }
		add_resource = { sr_pantsu = -1000 }
		give_technology = { tech = tech_wg_doom }
        add_modifier = { modifier = wg_modifier_weapon_payment days = 180 }
        hidden_effect = { country_event = { id = wsgranking.1005 }}
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = tech_wsg_356laser
        custom_tooltip = "tech_wsg_356laser_desc"
        trigger = {
            has_authority = auth_warshipgirls
            NOR = {
                has_tech_option = tech_wsg_356laser
                has_technology = tech_wsg_356laser
            }
        }
        allow = {
            resource_stockpile_compare = { resource = sr_pantsu value >= 2200 }
            if = {
                limit = { hidden_trigger = { has_ascension_perk = ap_mist }}
                has_technology = tech_wsg_203
            } else_if = {
                limit = { hidden_trigger = { has_ascension_perk = ap_project_s }}
                has_technology = tech_wsg_weapon_S_300
            }
            custom_tooltip = {
				fail_text = too_low_rank_fail_120
				check_variable = { which = "rankpts" value >= 120 }
            }
            custom_tooltip = {
                NOT = { has_modifier = wg_modifier_weapon_payment }
                fail_text = tech_cooldown_desc
            }
        }
        add_resource = {
            sr_pantsu = -2200
        }
        give_technology = { tech = tech_wsg_356laser }
        add_modifier = { modifier = wg_modifier_weapon_payment days = 180 }
        hidden_effect = { country_event = { id = wsgranking.1005 }}
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = tech_wsg_410
        custom_tooltip = "tech_wsg_410_desc"
        trigger = {
            has_authority = auth_warshipgirls
            has_ascension_perk = ap_mist
            NOR = {
                has_tech_option = tech_wsg_410
                has_technology = tech_wsg_410
            }
        }
        allow = {
            resource_stockpile_compare = { resource = sr_pantsu value >= 3000 }
            resource_stockpile_compare = { resource = sr_alpha value >= 3000 }
            has_technology = tech_wsg_406
            custom_tooltip = {
                has_country_flag = tr_wg_shop_4_adopt
                fail_text = need_tr_wg_shop_4_adopt
            }
            custom_tooltip = {
				fail_text = too_low_rank_fail_180
				check_variable = { which = "rankpts" value >= 180 }
            }
            custom_tooltip = {
                NOT = { has_modifier = wg_modifier_weapon_payment }
                fail_text = tech_cooldown_desc
            }
        }
        add_resource = {
            sr_pantsu = -3000
            sr_alpha = -3000
        }
        give_technology = { tech = tech_wsg_410 }
        add_modifier = { modifier = wg_modifier_weapon_payment days = 180 }
        hidden_effect = { country_event = { id = wsgranking.1005 }}
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = tech_wsg_EW
        custom_tooltip = "tech_wsg_EW_desc"
        trigger = {
            has_authority = auth_warshipgirls
            has_ascension_perk = ap_mist
            NOR = {
                has_tech_option = tech_wsg_EW
                has_technology = tech_wsg_EW
            }
        }
        allow = {
            resource_stockpile_compare = { resource = sr_pantsu value >= 4000 }
            resource_stockpile_compare = { resource = sr_alpha value >= 3000 }
            has_technology = tech_wsg_406
            custom_tooltip = {
				fail_text = too_low_rank_fail_210
				check_variable = { which = "rankpts" value >= 210 }
            }
            custom_tooltip = {
                NOT = { has_modifier = wg_modifier_weapon_payment }
                fail_text = tech_cooldown_desc
            }
        }
        add_resource = {
            sr_pantsu = -4000
            sr_alpha = -3000
        }
        give_technology = { tech = tech_wsg_EW }
        add_modifier = { modifier = wg_modifier_weapon_payment days = 180 }
        hidden_effect = { country_event = { id = wsgranking.1005 }}
    }	
    ## 深海武器兑换
	option = {
		custom_gui = "enclave_caravaneer_option"
		name = tech_sh_autocannon
        custom_tooltip = "tech_sh_autocannon_desc"
		trigger = {
            has_authority = auth_shenhai
			NOR = { 
                has_tech_option = tech_sh_autocannon
                has_technology = tech_sh_autocannon 
            }
		}
		allow = {
			resource_stockpile_compare = { resource = sr_pantsu value >= 2500 }
			resource_stockpile_compare = { resource = sr_se value >= 2000 }
			has_technology = tech_sh_Lweapon
			custom_tooltip = {
				fail_text = too_low_rank_fail_90
				check_variable = { which = "rankpts" value >= 90 }
            }
            custom_tooltip = {
                NOT = { has_modifier = wg_modifier_weapon_payment }
                fail_text = tech_cooldown_desc
            }
		}
		add_resource = {
			sr_pantsu = -2500
			sr_se = -2000
		}
		give_technology = { tech = tech_sh_autocannon }
        add_modifier = { modifier = wg_modifier_weapon_payment days = 90 }
        hidden_effect = { country_event = { id = wsgranking.1005 }}
	}
	option = {
		custom_gui = "enclave_caravaneer_option"
		name = tech_sh_fighter
        custom_tooltip = "tech_sh_fighter_desc"
		trigger = {
            has_authority = auth_shenhai
			NOR = { 
                has_tech_option = tech_sh_fighter
                has_technology = tech_sh_fighter 
            }
		}
		allow = {
			resource_stockpile_compare = { resource = sr_pantsu value >= 2500 }
			resource_stockpile_compare = { resource = sr_se value >= 2000 }
			has_technology = tech_sh_Lweapon
			custom_tooltip = {
				fail_text = too_low_rank_fail_120
				check_variable = { which = "rankpts" value >= 120 }
            }
            custom_tooltip = {
                NOT = { has_modifier = wg_modifier_weapon_payment }
                fail_text = tech_cooldown_desc
            }
		}
		add_resource = {
			sr_pantsu = -2500
			sr_se = -1000
		}
		give_technology = { tech = tech_sh_fighter }
        add_modifier = { modifier = wg_modifier_weapon_payment days = 90 }
        hidden_effect = { country_event = { id = wsgranking.1005 }}
	}
	option = {
		custom_gui = "enclave_caravaneer_option"
		name = tech_sh_torpedo
        custom_tooltip = "tech_sh_torpedo_desc"
		trigger = {
            has_authority = auth_shenhai
			NOR = {
                has_tech_option = tech_sh_torpedo
                has_technology = tech_sh_torpedo
            }
		}
		allow = {
			resource_stockpile_compare = { resource = sr_pantsu value >= 2500 }
			resource_stockpile_compare = { resource = sr_se value >= 2000 }
			has_technology = tech_sh_Lweapon
			has_technology = tech_sh_Gweapon
			custom_tooltip = {
				fail_text = too_low_rank_fail_120
				check_variable = { which = "rankpts" value >= 120 }
            }
            custom_tooltip = {
                NOT = { has_modifier = wg_modifier_weapon_payment }
                fail_text = tech_cooldown_desc
            }
		}
		add_resource = {
			sr_pantsu = -2500
			sr_se = -2000
		}
		give_technology = { tech = tech_sh_torpedo }
        add_modifier = { modifier = wg_modifier_weapon_payment days = 90 }
        hidden_effect = { country_event = { id = wsgranking.1005 }}
	}
	option = {
		custom_gui = "enclave_caravaneer_option"
		name = tech_sh_XACweapon
        custom_tooltip = "tech_sh_XACweapon_desc"
		trigger = {
            has_authority = auth_shenhai
			NOR = { 
                has_tech_option = tech_sh_XACweapon
                has_technology = tech_sh_XACweapon
            }
		}
		allow = {
			resource_stockpile_compare = { resource = sr_pantsu value >= 3500 }
			resource_stockpile_compare = { resource = sr_se value >= 2500 }
			has_technology = tech_sh_Lweapon
            custom_tooltip = {
                has_country_flag = tr_wg_shop_4_adopt
                fail_text = need_tr_wg_shop_4_adopt
            }
			custom_tooltip = {
				fail_text = too_low_rank_fail_150
				check_variable = { which = "rankpts" value >= 150 }
            }
            custom_tooltip = {
                NOT = { has_modifier = wg_modifier_weapon_payment }
                fail_text = tech_cooldown_desc
            }
		}
		add_resource = {
			sr_pantsu = -3500
			sr_se = -2500
		}
		give_technology = { tech = tech_sh_XACweapon }
        add_modifier = { modifier = wg_modifier_weapon_payment days = 90 }
        hidden_effect = { country_event = { id = wsgranking.1005 }}
	}
	option = {#大波波科研船
		custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_science_ship2
        trigger = { NOT = { has_country_flag = for_Polanian }}
		allow = {
			resource_stockpile_compare = { resource = energy value >= 500 }
			custom_tooltip = {
				fail_text = too_low_rank_fail_10
				check_variable = { which = "rankpts" value >= 10 }
            }
		}
        custom_tooltip = "pantsu_shop_science_ship_desc"
		create_fleet = {
			name = "NAME_pantsu_shop_science_ship"
			effect = {
				set_owner = root
				create_ship = {
					name = random
					design = "NAME_pantsu_shop_science_ship"
					upgradable = no
				}
				set_location = {
					target = root.capital_scope
					distance = 30
					angle = random
				}
			}
		}
		add_resource = { energy = -500 }
        hidden_effect = { country_event = { id = wsgranking.1005 }}
		set_country_flag = for_Polanian
	}
	option = {#航母计算机
		custom_gui = "enclave_caravaneer_option"
		name = tech_wg_carrier_computer
        custom_tooltip = "tech_wg_carrier_computer_desc"
		trigger = {
			has_technology = tech_battleships
			NOR = { 
                has_tech_option = tech_wg_carrier_computer
                has_technology = tech_wg_carrier_computer
            }
		}
		allow = {
			resource_stockpile_compare = { resource = energy value >= 6000 }
			resource_stockpile_compare = { resource = sr_pantsu value >= 1500 }
			custom_tooltip = {
				fail_text = too_low_rank_fail_60
				check_variable = { which = "rankpts" value >= 60 }
            }
            custom_tooltip = {
                NOT = { has_modifier = wg_modifier_weapon_payment }
                fail_text = tech_cooldown_desc
            }
		}
		add_resource = {
			sr_pantsu = -1500
			energy = -6000
		}
		give_technology = { tech = tech_wg_carrier_computer }
        add_modifier = { modifier = wg_modifier_weapon_payment days = 90 }
        hidden_effect = { country_event = { id = wsgranking.1005 }}
    }
    
    # 二飞舰娘武器
    # X槽S450
    option = {
		custom_gui = "enclave_caravaneer_option"
		name = tech_wsg_weapon_X_S450
        custom_tooltip = "tech_wsg_weapon_X_S450_desc"
		trigger = {
            has_authority = auth_warshipgirls
            has_ascension_perk = ap_project_s
			NOR = { 
                has_tech_option = tech_wsg_weapon_X_S450
                has_technology = tech_wsg_weapon_X_S450
            }
		}
		allow = {
			resource_stockpile_compare = { resource = sr_pantsu value >= 2500 }
			resource_stockpile_compare = { resource = sr_se value >= 2000 }
			has_technology = tech_wsg_weapon_S_300
            custom_tooltip = {
                has_country_flag = tr_wg_shop_4_adopt
                fail_text = need_tr_wg_shop_4_adopt
            }
			custom_tooltip = {
				fail_text = too_low_rank_fail_150
				check_variable = { which = "rankpts" value >= 150 }
            }
            custom_tooltip = {
                NOT = { has_modifier = wg_modifier_weapon_payment }
                fail_text = tech_cooldown_desc
            }
		}
		add_resource = {
			sr_pantsu = -2500
			sr_se = -2000
		}
		give_technology = { tech = tech_wsg_weapon_X_S450 }
        add_modifier = { modifier = wg_modifier_weapon_payment days = 180 }
        hidden_effect = { country_event = { id = wsgranking.1005 }}
    }
    
    # T槽S510
    option = {
		custom_gui = "enclave_caravaneer_option"
		name = tech_wsg_weapon_T_S510
        custom_tooltip = "tech_wsg_weapon_T_S510_desc"
		trigger = {
            has_authority = auth_warshipgirls
            has_ascension_perk = ap_project_s
			NOR = { 
                has_tech_option = tech_wsg_weapon_T_S510
                has_technology = tech_wsg_weapon_T_S510
            }
		}
		allow = {
			resource_stockpile_compare = { resource = sr_pantsu value >= 3500 }
			resource_stockpile_compare = { resource = sr_se value >= 2500 }
			has_technology = tech_wsg_weapon_S_460
            custom_tooltip = {
                has_country_flag = tr_wg_shop_4_adopt
                fail_text = need_tr_wg_shop_4_adopt
            }
			custom_tooltip = {
				fail_text = too_low_rank_fail_210
				check_variable = { which = "rankpts" value >= 210 }
            }
            custom_tooltip = {
                NOT = { has_modifier = wg_modifier_weapon_payment }
                fail_text = tech_cooldown_desc
            }
		}
		add_resource = {
			sr_pantsu = -3500
			sr_se = -2500
		}
		give_technology = { tech = tech_wsg_weapon_T_S510 }
        add_modifier = { modifier = wg_modifier_weapon_payment days = 180 }
        hidden_effect = { country_event = { id = wsgranking.1005 }}
	}

    # 返回一级菜单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_menu
        hidden_effect = {
            country_event = { id = wsgranking.1004 }
        }
    }

    # 返回主选单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_main
        hidden_effect = {
            country_event = { id = wsgranking.1001 }
        }
    }

    # 退出
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
        remove_country_flag = engaged_with_pantsu_shop
    }
}

# 产生随机购买清单
country_event = {
	id = wsgranking.1006
    hide_window = yes
    is_triggered_only = yes

    trigger = {
        NOT = { has_country_flag = generated_mod_random_list }
    }

    immediate = {
        set_timed_country_flag = { flag = generated_mod_random_list days = 360 }
        while = { count = 3
            random_list = {
                # 用随机列表来产生有时限的flag，然后用flag来判定哪些东西被抽中了
                # 时限就是刷新CD
                1 = { set_timed_country_flag = { flag = wsgrank_mod1 days = 360 }}
                1 = {}
            }
        }
    }
}

# 二级菜单 - 兑换修正
country_event = {
	id = wsgranking.1007
	title = pantsu_shop_name
	desc = wsgranking.1007.desc
    desc = {
        exclusive_trigger = { has_country_flag = pantsu_shop_origin }
        text = wsgranking.1007.desc.b
    }
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
		room = Martes_room
    }
    
    trigger = {
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

    option = {
		custom_gui = "enclave_caravaneer_option"
		# 兑换工业buff
		name = wsgranking.1007.a
		hidden_effect = { country_event = { id = wsgranking.1020 }}
	}
	option = {
		custom_gui = "enclave_caravaneer_option"
		# 兑换外交buff
		name = wsgranking.1007.b
		hidden_effect = { country_event = { id = wsgranking.1021 }}
	}
	option = {
		custom_gui = "enclave_caravaneer_option"
		# 兑换战斗buff
		name = wsgranking.1007.c
		hidden_effect = { country_event = { id = wsgranking.1022 }}
	}

    # 返回一级菜单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_menu
        hidden_effect = {
            country_event = { id = wsgranking.1004 }
        }
    }

    # 返回主选单
    option = { custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_main
        hidden_effect = {
            country_event = { id = wsgranking.1001 }
        }
    }

    # 退出
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
        remove_country_flag = engaged_with_pantsu_shop
    }
}

# 产生随机购买清单 - 待用
country_event = {
	id = wsgranking.1008
    hide_window = yes
    is_triggered_only = yes

    trigger = {
        NOT = { has_country_flag = generated_item_random_list }
    }

    immediate = {
        set_timed_country_flag = { flag = generated_item_random_list days = 360 }
        while = { 
            count = 3
            random_list = {
                # 用随机列表来产生有时限的flag，然后用flag来判定哪些东西被抽中了
                # 时限就是刷新CD
                1 = { set_timed_country_flag = { flag = wsgrank_item1 days = 360 }}
                1 = {}
            }
        }
    }
}

# 二级菜单 - 兑换杂项资源
country_event = {
	id = wsgranking.1009
	title = pantsu_shop_name
	desc = wsgranking.1009.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
		room = Shop_room
    }
    
    trigger = {
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        # 一次性兑换资源
        allow = { has_any_rare_resource_tech = yes }
        name = wsgranking.1009.a
        hidden_effect = {
            set_variable = { which = wg_shop_exchange_resource value = 100 }
            country_event = { id = wsgranking.1011 }
        }
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        # 长期资源交易
        name = wsgranking.1009.b
        allow = {
            has_any_rare_resource_tech = yes
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        hidden_effect = {
            if = {
                limit = { 
                    sign_all_pantsu_shop_contract = no
                }
                country_event = { id = wsgranking.1014 }
            } else = {
                country_event = { id = wsgranking.1015 }
            }
        }
    }

    option = {
        custom_gui = "enclave_caravaneer_option"
        # 取消货物协议
        name = end_contract
        trigger = { 
            has_any_pantsu_shop_contract = yes
        }
        hidden_effect = { country_event = { id = wsgranking.1016 }}
    }

    option = {
        custom_gui = "enclave_caravaneer_option"
        # 取消所有货物协议
        name = end_all_contract
        trigger = {
            has_any_pantsu_shop_contract = yes
        }
        hidden_effect = { country_event = { id = wsgranking.1017 }}
    }

    # 返回一级菜单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_menu
        hidden_effect = {
            country_event = { id = wsgranking.1004 }
        }
    }

    # 返回主选单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_main
        hidden_effect = {
            country_event = { id = wsgranking.1001 }
        }
    }

    # 退出
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
        remove_country_flag = engaged_with_pantsu_shop
    }
}

# 三级菜单 - 兑换一次性资源 - 少量
country_event = {
	id = wsgranking.1011
	title = pantsu_shop_name
	desc = wsgranking.1011.desc
    desc = {
        exclusive_trigger = { has_country_flag = pantsu_shop_origin }
        text = wsgranking.1011.desc.b
    }
    custom_gui = "wg_shop_resource_window"
    diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
		room = Shop_room
    }
    
    trigger = {
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2dm
        allow = { 
            has_technology = tech_mine_dark_matter
            resource_stockpile_compare = { resource = sr_pantsu value >= 1 mult = wg_shop_exchange_resource }
            custom_tooltip = {
                check_variable = {
                    which = wg_shop_exchange_resource
                    value < event_target:pantsu_shop_country.dark_matter_stock
                }
                fail_text = dark_matter_sold_out
            }
        }
        hidden_effect = {
            event_target:pantsu_shop_country = { 
                set_variable = { which = dark_matter_out value = root.wg_shop_exchange_resource }
                multiply_variable = { which = dark_matter_out  value = 1.25 }
                subtract_variable = { which = dark_matter_stock value = dark_matter_out }
            }
            event_target:pantsu_shop_country = { subtract_variable = { which = dark_matter_stock value = wg_shop_exchange_resource }}
            country_event = { id = wsgranking.1011 }
        }
        add_resource = {
            sr_pantsu = -1
            sr_dark_matter = 1
            mult = wg_shop_exchange_resource
        }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2zro
        allow = { 
            has_technology = tech_mine_zro
            resource_stockpile_compare = { resource = sr_pantsu value >= 1 mult = wg_shop_exchange_resource }
            custom_tooltip = {
                check_variable_arithmetic = {
                    which = wg_shop_exchange_resource
                    multiply = 1.25
                    value < event_target:pantsu_shop_country.zro_stock
                }
                fail_text = zro_sold_out
            }
        }
        hidden_effect = {
            event_target:pantsu_shop_country = { 
                set_variable = { which = zro_out value = root.wg_shop_exchange_resource }
                multiply_variable = { which = zro_out  value = 1.25 }
                subtract_variable = { which = zro_stock value = zro_out }
            }
            country_event = { id = wsgranking.1011 }
        }
        add_resource = {
            sr_pantsu = -1
            sr_zro = 1.25
            mult = wg_shop_exchange_resource
        }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2lm
        allow = { 
            has_technology = tech_mine_living_metal
            resource_stockpile_compare = { resource = sr_pantsu value >= 1 mult = wg_shop_exchange_resource }
            custom_tooltip = {
                check_variable_arithmetic = {
                    which = wg_shop_exchange_resource
                    multiply = 1.25
                    value < event_target:pantsu_shop_country.living_metal_stock
                }
                fail_text = living_metal_sold_out
            }
        }
        hidden_effect = {
            event_target:pantsu_shop_country = { 
                set_variable = { which = living_metal_out value = root.wg_shop_exchange_resource }
                multiply_variable = { which = living_metal_out  value = 1.25 }
                subtract_variable = { which = living_metal_stock value = living_metal_out }
            }
            country_event = { id = wsgranking.1011 }
        }
        add_resource = {
            sr_pantsu = -1
            sr_living_metal = 1.25
            mult = wg_shop_exchange_resource
        }
    }
    
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2nanite
        trigger = { OR = {
			has_global_flag = lgates_activated_globally
			has_technology = tech_TMR_nanite_productor
		} }
        allow = { 
            resource_stockpile_compare = { resource = sr_pantsu value >= 1 mult = wg_shop_exchange_resource }
            custom_tooltip = {
                check_variable_arithmetic = {
                    which = wg_shop_exchange_resource
                    multiply = 0.3
                    value < event_target:pantsu_shop_country.nanite_stock
                }
                fail_text = nanite_sold_out
            }
        }
        hidden_effect = {
            event_target:pantsu_shop_country = { 
                set_variable = { which = nanite_out value = root.wg_shop_exchange_resource }
                multiply_variable = { which = nanite_out value = 0.3 }
                subtract_variable = { which = nanite_stock value = nanite_out }
            }
            country_event = { id = wsgranking.1011 }
        }
        add_resource = {
            sr_pantsu = -1
            nanites = 0.3
            mult = wg_shop_exchange_resource
        }
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2alpha
        allow = { 
            has_technology = tech_building_wsg_alpha
            resource_stockpile_compare = { resource = sr_pantsu value >= 1 mult = wg_shop_exchange_resource }
            custom_tooltip = {
                check_variable_arithmetic = {
                    which = wg_shop_exchange_resource
                    multiply = 0.6
                    value < event_target:pantsu_shop_country.alpha_stock
                }
                fail_text = alpha_sold_out
            }
        }
        hidden_effect = {
            event_target:pantsu_shop_country = { 
                set_variable = { which = alpha_out value = root.wg_shop_exchange_resource }
                multiply_variable = { which = alpha_out value = 0.6 }
                subtract_variable = { which = alpha_stock value = alpha_out }
            }
            country_event = { id = wsgranking.1011 }
        }
        add_resource = {
            sr_alpha = 0.6
            sr_pantsu = -1
            mult = wg_shop_exchange_resource
        }
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2se
        allow = { 
            resource_stockpile_compare = { resource = sr_se value >= 1 }
            resource_stockpile_compare = { resource = sr_pantsu value >= 1 mult = wg_shop_exchange_resource }
            custom_tooltip = {
                check_variable_arithmetic = {
                    which = wg_shop_exchange_resource
                    multiply = 0.6
                    value < event_target:pantsu_shop_country.se_stock
                }
                fail_text = se_sold_out
            }
        }
        hidden_effect = {
            event_target:pantsu_shop_country = { 
                set_variable = { which = se_out value = root.wg_shop_exchange_resource }
                multiply_variable = { which = se_out value = 0.6 }
                subtract_variable = { which = se_stock value = se_out }
            }
            country_event = { id = wsgranking.1011 }
        }
        add_resource = {
            sr_se = 0.6
            sr_pantsu = -1
            mult = wg_shop_exchange_resource
        }
    }

    # 返回一级菜单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_menu
        hidden_effect = {
            country_event = { id = wsgranking.1009 }
        }
    }

    # 返回主选单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_main
        hidden_effect = {
            country_event = { id = wsgranking.1001 }
        }
    }

    # 退出
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
        hidden_effect = { set_variable = { which = wg_shop_exchange_resource value = 0 }}
        remove_country_flag = engaged_with_pantsu_shop
    }
}

#三级菜单 - 兑换长期资源贸易协议
country_event = {
	id = wsgranking.1014
	title = pantsu_shop_name
	desc = wsgranking.1014.desc
    desc = {
        exclusive_trigger = { has_country_flag = pantsu_shop_origin }
        text = wsgranking.1011.desc.b
    }
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
		room = Shop_room
    }
    
    trigger = {
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1014.a
        trigger = { 
            sign_all_pantsu_shop_contract = no
        }
        allow = {
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
		allow = { 
            custom_tooltip = {
                has_country_flag = tr_wg_shop_5_adopt
                fail_text = need_tr_wg_shop_5_adopt
            }
        }
        hidden_effect = { country_event = { id = wsgranking.1015 }}
    }
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = end_contract
        trigger = { 
            has_any_pantsu_shop_contract = yes
        }
        hidden_effect = { country_event = { id = wsgranking.1016 }}
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2dm_contract
        trigger = { 
            NOT = { has_modifier = pantsu_shop_dark_matter_contract }
        }
        allow = { 
            has_technology = tech_mine_dark_matter
            resource_income_compare = { resource = sr_pantsu value >= 30 }
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        if = {
            limit = { has_modifier = pantsu_shop_dark_matter_contract_massive }
            remove_modifier = pantsu_shop_dark_matter_contract_massive
        }
        add_modifier = { modifier = pantsu_shop_dark_matter_contract days = -1 }
        hidden_effect = { country_event = { id = wsgranking.1014 }}
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2zro_contract
        trigger = { 
            NOT = { has_modifier = pantsu_shop_zro_contract }
        }
        allow = { 
            has_technology = tech_mine_zro
            resource_income_compare = { resource = sr_pantsu value >= 30 }
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        if = {
            limit = { has_modifier = pantsu_shop_zro_contract_massive }
            remove_modifier = pantsu_shop_zro_contract_massive
        }
        add_modifier = { modifier = pantsu_shop_zro_contract days = -1 }
        hidden_effect = { country_event = { id = wsgranking.1014 }}
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2lm_contract
        trigger = { 
            NOT = { has_modifier = pantsu_shop_living_metal_contract }
        }
        allow = { 
            has_technology = tech_mine_living_metal 
            resource_income_compare = { resource = sr_pantsu value >= 30 }
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        if = {
            limit = { has_modifier = pantsu_shop_living_metal_contract_massive }
            remove_modifier = pantsu_shop_living_metal_contract_massive
        }
        add_modifier = { modifier = pantsu_shop_living_metal_contract days = -1 }
        hidden_effect = { country_event = { id = wsgranking.1014 }}
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2nanite_contract
        trigger = { 
            NOT = { has_modifier = pantsu_shop_nanites_contract }
            OR = {
                has_global_flag = lgates_activated_globally
                has_technology = tech_TMR_nanite_productor
            }
        }
        allow = { 
            resource_income_compare = { resource = sr_pantsu value >= 30 }
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        if = {
            limit = { has_modifier = pantsu_shop_nanites_contract_massive }
            remove_modifier = pantsu_shop_nanites_contract_massive
        }
        add_modifier = { modifier = pantsu_shop_nanites_contract days = -1 }
        hidden_effect = { country_event = { id = wsgranking.1014 }}
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2alpha_contract
        trigger = { 
            NOT = { has_modifier = pantsu_shop_alpha_contract }
        }
        allow = { 
            has_technology = tech_building_wsg_alpha 
            resource_income_compare = { resource = sr_pantsu value >= 30 }
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        if = {
            limit = { has_modifier = pantsu_shop_alpha_contract_massive }
            remove_modifier = pantsu_shop_alpha_contract_massive
        }
        add_modifier = { modifier = pantsu_shop_alpha_contract days = -1 }
        hidden_effect = { country_event = { id = wsgranking.1014 }}
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2se_contract
        trigger = { 
            NOT = { has_modifier = pantsu_shop_se_contract }
        }
        allow = { 
            resource_stockpile_compare = { resource = sr_se value >= 1 }
            resource_income_compare = { resource = sr_pantsu value >= 30 }
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        if = {
            limit = { has_modifier = pantsu_shop_se_contract_massive }
            remove_modifier = pantsu_shop_se_contract_massive
        }
        add_modifier = { modifier = pantsu_shop_se_contract days = -1 }
        hidden_effect = { country_event = { id = wsgranking.1014 }}
    }

    # 返回一级菜单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_menu
        hidden_effect = {
            country_event = { id = wsgranking.1009 }
        }
    }

    # 返回主选单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_main
        hidden_effect = {
            country_event = { id = wsgranking.1001 }
        }
    }

    # 退出
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
        remove_country_flag = engaged_with_pantsu_shop
    }
}

#三级菜单 - 兑换长期资源贸易协议 - 大量
country_event = {
	id = wsgranking.1015
	title = pantsu_shop_name
	desc = wsgranking.1014.desc
    desc = {
        exclusive_trigger = { has_country_flag = pantsu_shop_origin }
        text = wsgranking.1011.desc.b
    }
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
		room = Shop_room
    }
    
    trigger = {
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1015.a
        trigger = {
            sign_all_pantsu_shop_contract = no
        }
        allow = {
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        hidden_effect = { country_event = { id = wsgranking.1014 }}
    }
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = end_contract
        trigger = { 
            has_any_pantsu_shop_contract = yes
        }
        hidden_effect = { country_event = { id = wsgranking.1016 }}
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2dm_contract
        trigger = { 
            NOT = { has_modifier = pantsu_shop_dark_matter_contract_massive }
        }
        allow = { 
            has_technology = tech_mine_dark_matter
            resource_income_compare = { resource = sr_pantsu value >= 100 }
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        if = {
            limit = { has_modifier = pantsu_shop_dark_matter_contract }
            remove_modifier = pantsu_shop_dark_matter_contract
        }
        add_modifier = { modifier = pantsu_shop_dark_matter_contract_massive days = -1 }
        hidden_effect = { country_event = { id = wsgranking.1015 }}
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2zro_contract
        trigger = { 
            NOT = { has_modifier = pantsu_shop_zro_contract_massive }
        }
        allow = { 
            has_technology = tech_mine_zro
            resource_income_compare = { resource = sr_pantsu value >= 100 }
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        if = {
            limit = { has_modifier = pantsu_shop_zro_contract }
            remove_modifier = pantsu_shop_zro_contract
        }
        add_modifier = { modifier = pantsu_shop_zro_contract_massive days = -1 }
        hidden_effect = { country_event = { id = wsgranking.1015 }}
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2lm_contract
        trigger = { 
            NOT = { has_modifier = pantsu_shop_living_metal_contract_massive }
        }
        allow = { 
            has_technology = tech_mine_living_metal 
            resource_income_compare = { resource = sr_pantsu value >= 100 }
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        if = {
            limit = { has_modifier = pantsu_shop_living_metal_contract }
            remove_modifier = pantsu_shop_living_metal_contract
        }
        add_modifier = { modifier = pantsu_shop_living_metal_contract_massive days = -1 }
        hidden_effect = { country_event = { id = wsgranking.1015 }}
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2nanite_contract
        trigger = { 
            NOT = { has_modifier = pantsu_shop_nanites_contract_massive }
            has_global_flag = lgates_activated_globally
        }
        allow = { 
            resource_income_compare = { resource = sr_pantsu value >= 100 }
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        if = {
            limit = { has_modifier = pantsu_shop_nanites_contract }
            remove_modifier = pantsu_shop_nanites_contract
        }
        add_modifier = { modifier = pantsu_shop_nanites_contract_massive days = -1 }
        hidden_effect = { country_event = { id = wsgranking.1015 }}
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2alpha_contract
        trigger = { 
            NOT = { has_modifier = pantsu_shop_alpha_contract_massive }
        }
        allow = { 
            has_technology = tech_building_wsg_alpha 
            resource_income_compare = { resource = sr_pantsu value >= 100 }
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        if = {
            limit = { has_modifier = pantsu_shop_alpha_contract }
            remove_modifier = pantsu_shop_alpha_contract
        }
        add_modifier = { modifier = pantsu_shop_alpha_contract_massive days = -1 }
        hidden_effect = { country_event = { id = wsgranking.1015 }}
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2se_contract
        trigger = { 
            NOT = { has_modifier = pantsu_shop_se_contract }
        }
        allow = { 
            resource_stockpile_compare = { resource = sr_se value >= 1 }
            resource_income_compare = { resource = sr_pantsu value >= 100 }
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        if = {
            limit = { has_modifier = pantsu_shop_se_contract }
            remove_modifier = pantsu_shop_se_contract
        }
        add_modifier = { modifier = pantsu_shop_se_contract_massive days = -1 }
        hidden_effect = { country_event = { id = wsgranking.1015 }}
    }

    # 返回一级菜单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_menu
        hidden_effect = {
            country_event = { id = wsgranking.1009 }
        }
    }

    # 返回主选单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_main
        hidden_effect = {
            country_event = { id = wsgranking.1001 }
        }
    }

    # 退出
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
        remove_country_flag = engaged_with_pantsu_shop
    }
}

#三级菜单 - 终止贸易
country_event = {
	id = wsgranking.1016
	title = pantsu_shop_name
	desc = wsgranking.1016.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
		room = Shop_room
    }
    
    trigger = {
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        # 长期资源交易
        name = wsgranking.1009.b
        trigger = { }
        allow = {
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        hidden_effect = {
            if = {
                limit = {
                    sign_all_pantsu_shop_contract = no
                }
                country_event = { id = wsgranking.1014 }
            } else = {
                country_event = { id = wsgranking.1015 }
            }
        }
    }

    option = {
        custom_gui = "enclave_caravaneer_option"
        # 取消所有货物协议
        name = end_all_contract
        trigger = { 
            has_any_pantsu_shop_contract = yes
        }
        hidden_effect = { country_event = { id = wsgranking.1017 }}
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1016.a
        trigger = { 
            OR = {
                has_modifier = pantsu_shop_dark_matter_contract
                has_modifier = pantsu_shop_dark_matter_contract_massive 
            }
        }
        is_dialog_only = yes
        response_text = comfirm_cancellation
        remove_modifier = pantsu_shop_dark_matter_contract
        remove_modifier = pantsu_shop_dark_matter_contract_massive
        hidden_effect = { country_event = { id = wsgranking.1016 }}
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1016.b
        trigger = { 
            OR = {
                has_modifier = pantsu_shop_zro_contract
                has_modifier = pantsu_shop_zro_contract_massive 
            }
        }
        is_dialog_only = yes
        response_text = comfirm_cancellation
        remove_modifier = pantsu_shop_zro_contract
        remove_modifier = pantsu_shop_zro_contract_massive
        hidden_effect = { country_event = { id = wsgranking.1016 }}
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1016.c
        trigger = { 
            OR = {
                has_modifier = pantsu_shop_living_metal_contract
                has_modifier = pantsu_shop_living_metal_contract_massive 
            }
        }
        is_dialog_only = yes
        response_text = comfirm_cancellation
        remove_modifier = pantsu_shop_living_metal_contract
        remove_modifier = pantsu_shop_living_metal_contract_massive
        hidden_effect = { country_event = { id = wsgranking.1016 }}
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1016.d
        trigger = { 
            OR = {
                has_modifier = pantsu_shop_nanites_contract
                has_modifier = pantsu_shop_nanites_contract_massive 
            }
        }
        is_dialog_only = yes
        response_text = comfirm_cancellation
        remove_modifier = pantsu_shop_nanites_contract
        remove_modifier = pantsu_shop_nanites_contract_massive
        hidden_effect = { country_event = { id = wsgranking.1016 }}
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1016.e
        trigger = { 
            OR = {
                has_modifier = pantsu_shop_alpha_contract 
                has_modifier = pantsu_shop_alpha_contract_massive 
            }
        }
        is_dialog_only = yes
        response_text = comfirm_cancellation
        remove_modifier = pantsu_shop_alpha_contract
        remove_modifier = pantsu_shop_alpha_contract_massive
        hidden_effect = { country_event = { id = wsgranking.1016 }}
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1016.f
        trigger = { 
            OR = {
                has_modifier = pantsu_shop_se_contract 
                has_modifier = pantsu_shop_se_contract_massive
            }
        }
        is_dialog_only = yes
        response_text = comfirm_cancellation
        remove_modifier = pantsu_shop_se_contract
        remove_modifier = pantsu_shop_se_contract_massive
        hidden_effect = { country_event = { id = wsgranking.1016 }}
    }

    # 返回一级菜单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_menu
        hidden_effect = {
            country_event = { id = wsgranking.1009 }
        }
    }

    # 返回主选单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_main
        hidden_effect = {
            country_event = { id = wsgranking.1001 }
        }
    }

    # 退出
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
        remove_country_flag = engaged_with_pantsu_shop
    }
}

# 确认取消所有协议
country_event = {
	id = wsgranking.1017
	title = pantsu_shop_name
	desc = wsgranking.1017.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
		room = Shop_room
    }
    
    trigger = {
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

    # 确认取消所有协议
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1017.a
        remove_modifier = pantsu_shop_dark_matter_contract
        remove_modifier = pantsu_shop_dark_matter_contract_massive
        remove_modifier = pantsu_shop_zro_contract
        remove_modifier = pantsu_shop_zro_contract_massive
        remove_modifier = pantsu_shop_living_metal_contract
        remove_modifier = pantsu_shop_living_metal_contract_massive
        remove_modifier = pantsu_shop_nanites_contract
        remove_modifier = pantsu_shop_nanites_contract_massive
        remove_modifier = pantsu_shop_alpha_contract
        remove_modifier = pantsu_shop_alpha_contract_massive
        remove_modifier = pantsu_shop_se_contract
        remove_modifier = pantsu_shop_se_contract_massive
        country_event = { id = wsgranking.1009 }
    }

    # 返回一级菜单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_menu
        hidden_effect = {
            country_event = { id = wsgranking.1009 }
        }
    }

    # 返回主选单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_main
        hidden_effect = {
            country_event = { id = wsgranking.1001 }
        }
    }

    # 退出
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
        remove_country_flag = engaged_with_pantsu_shop
    }
}

country_event = {
    id = wsgranking.1018
    title = pantsu_shop_name
	desc = wsgranking.1010.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
	is_triggered_only = yes
 
	picture_event_data = {
		room = Shop_room
    }

    trigger = {
        resource_stockpile_compare = { resource = sr_pantsu value <= 0 }
        has_any_pantsu_shop_contract = yes
    }

    option = {
        name = wsgranking.1018.a
        response_text = wsgranking.1018.a.response
        remove_modifier = pantsu_shop_dark_matter_contract
        remove_modifier = pantsu_shop_dark_matter_contract_massive
        remove_modifier = pantsu_shop_zro_contract
        remove_modifier = pantsu_shop_zro_contract_massive
        remove_modifier = pantsu_shop_living_metal_contract
        remove_modifier = pantsu_shop_living_metal_contract_massive
        remove_modifier = pantsu_shop_nanites_contract
        remove_modifier = pantsu_shop_nanites_contract_massive
        remove_modifier = pantsu_shop_alpha_contract
        remove_modifier = pantsu_shop_alpha_contract_massive
        remove_modifier = pantsu_shop_se_contract
        remove_modifier = pantsu_shop_se_contract_massive
        add_modifier = { modifier = pantsu_shop_contract_break days = 1440 }
        set_timed_country_flag = { flag = pantsu_shop_contract_break days = 3600 }
    }
}

event = {
    id = wsgranking.1999
    hide_window = yes
    is_triggered_only = yes

    trigger = {
        exists = event_target:pantsu_shop_country
    }

    immediate = {
        event_target:pantsu_shop_country = {
            if = {
                limit = { check_variable = { which = dark_matter_stock value < 2000000 }}
                if = {
                    limit = { check_variable = { which = dark_matter_stock value < 600000 }}
                    change_variable = { which = dark_matter_stock value = 35000 }
                } else = {
                    change_variable = { which = dark_matter_stock value = 20000 }
                }
            }
            if = {
                limit = { check_variable = { which = living_metal_stock value < 2000000 }}
                if = {
                    limit = { check_variable = { which = living_metal_stock value < 600000 }}
                    change_variable = { which = living_metal_stock value = 10000 }
                } else = {
                    change_variable = { which = living_metal_stock value = 3000 }
                }
            }
            if = {
                limit = { check_variable = { which = zro_stock value < 2000000 }}
                if = {
                    limit = { check_variable = { which = zro_stock value < 600000 }}
                    change_variable = { which = zro_stock value = 10000 }
                } else = {
                    change_variable = { which = zro_stock value = 3000 }
                }
            }
            if = {
                limit = { check_variable = { which = nanite_stock value < 1000000 }}
                if = {
                    limit = { check_variable = { which = nanite_stock value < 300000 }}
                    change_variable = { which = nanite_stock value = 15000 }
                } else = {
                    change_variable = { which = nanite_stock value = 6000 }
                }
            }
            if = {
                limit = { check_variable = { which = alpha_stock value < 1000000 }}
                if = {
                    limit = { check_variable = { which = alpha_stock value < 300000 }}
                    change_variable = { which = alpha_stock value = 10000 }
                } else = {
                    change_variable = { which = alpha_stock value = 6000 }
                }
            }
            if = {
                limit = { check_variable = { which = se_stock value < 1000000 }}
                if = {
                    limit = { check_variable = { which = se_stock value < 300000 }}
                    change_variable = { which = se_stock value = 10000 }
                } else = {
                    change_variable = { which = se_stock value = 6000 }
                }
            }
        }
    }
}

#二级菜单 - 购买戒指
country_event = {
	id = wsgranking.1010
	title = pantsu_shop_name
	desc = wsgranking.1010.desc
    desc = {
        exclusive_trigger = { has_country_flag = pantsu_shop_origin }
        text = wsgranking.1010.desc.b
    }
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
		room = Shop_room
    }
    
    trigger = {
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1010.a
        # 前置条件
        trigger = {
            has_authority = auth_warshipgirls
            NOR = {
                has_country_flag = wg_ascension_path_project_s
                has_technology = tech_wsg_senergy
            }
        }
        # 限制条件
        allow = {
            resource_stockpile_compare = { resource = energy value >= 2500 }
            resource_stockpile_compare = { resource = rare_crystals value >= 648 }
            resource_stockpile_compare = { resource = sr_pantsu value >= 648 }
			resource_stockpile_compare = { resource = sr_alpha value >= 648 }
				
        }
        hidden_effect = { 
            change_variable = { which = "wsg_rings" value = 1 }
        }
		add_resource = {
            energy = -2500
            rare_crystals = -648
            sr_alpha = -648
            sr_pantsu = -648
        }
        is_dialog_only = yes
        response_text = wsgranking.1010.desc
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1010.a
        # 前置条件
        trigger = {
            OR = {
                has_authority = auth_shenhai
                AND = {
                    has_authority = auth_warshipgirls
                    has_country_flag = wg_ascension_path_project_s
                }
            }
        }
        # 限制条件
        allow = {
            custom_tooltip_fail = {
                text = missing_tech_wsg_senergy
                OR = {
                    has_authority = auth_shenhai
                    AND = {
                        has_authority = auth_warshipgirls
                        has_technology = tech_wsg_senergy
                    }
                }
            }
            resource_stockpile_compare = { resource = energy value > 2500 }
            resource_stockpile_compare = { resource = rare_crystals value > 648 }
            resource_stockpile_compare = { resource = sr_se value > 648 }
            resource_stockpile_compare = { resource = sr_pantsu value > 648 }
        }
        change_variable = { which = "wsg_rings" value = 1 }
        #消耗资源
        add_resource = {
            energy = -2500
            rare_crystals = -648
            sr_se = -648
            sr_pantsu = -648
        }
        is_dialog_only = yes
        response_text = wsgranking.1010.desc
    }
	
	option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1010.a
        # 前置条件
        trigger = {
            OR = {
                has_authority = auth_shenhai
                has_authority = auth_warshipgirls
            }
			has_ascension_perk = ap_become_the_gray
        }
        # 限制条件
        allow = {
            resource_stockpile_compare = { resource = energy value > 2500 }
            resource_stockpile_compare = { resource = rare_crystals value > 648 }
            resource_stockpile_compare = { resource = nanites value > 648 }
        }
        change_variable = { which = "wsg_rings" value = 1 }
        #消耗资源
        add_resource = {
            energy = -2500
            rare_crystals = -648
            nanites = -648
        }
        is_dialog_only = yes
        response_text = wsgranking.1010.desc
    }
	
	option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1010.b
        # 前置条件
        trigger = {
            has_authority = auth_warshipgirls
            has_ascension_perk = ap_mist
			NOR = {
				has_country_flag = building_cunningmazon_m_allowed
				has_country_flag = building_cunningmazon_s_allowed
			}
        }
        # 限制条件
        allow = {
            resource_stockpile_compare = { resource = energy value >= 8000 }
			resource_stockpile_compare = { resource = sr_pantsu value > 1000 }
			resource_stockpile_compare = { resource = sr_alpha value >= 500 }
			custom_tooltip_fail = {
                text = missing_tech_wsg_alpha
                has_technology = tech_building_wsg_alpha
            }
        }
        hidden_effect = { 
            set_country_flag = building_cunningmazon_m_allowed
        }
		add_resource = {
            energy = -8000
			sr_pantsu = -1000
			sr_alpha = -500
        }
        is_dialog_only = yes
        response_text = wsgranking.1010.b.desc
		custom_tooltip = "wsgranking.1010.b.tooltip"
    }
	option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1010.b
        # 前置条件
        trigger = {
            OR = {
                has_authority = auth_shenhai
                has_authority = auth_warshipgirls
            }
			NOR = {
				has_country_flag = building_cunningmazon_m_allowed
				has_country_flag = building_cunningmazon_s_allowed
				has_ascension_perk = ap_mist
			}
        }
        # 限制条件
        allow = {
            custom_tooltip_fail = {
                text = missing_tech_wsg_senergy
                OR = {
                    has_technology = tech_wsg_senergy
				    has_technology = tech_sh_senergy
                }
            }
            resource_stockpile_compare = { resource = energy value > 8000 }
			resource_stockpile_compare = { resource = sr_pantsu value > 1000 }
			resource_stockpile_compare = { resource = sr_se value > 500 }
        }
        hidden_effect = { 
            set_country_flag = building_cunningmazon_s_allowed
        }
		add_resource = {
            energy = -8000
			sr_pantsu = -1000
			sr_se = -500
        }
        is_dialog_only = yes
        response_text = wsgranking.1010.b.desc
		custom_tooltip = "wsgranking.1010.b.tooltip"
    }

    # 返回一级菜单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_menu
        hidden_effect = { country_event = { id = wsgranking.1004 }}
    }

    # 返回主选单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_main
        hidden_effect = { country_event = { id = wsgranking.1001 }}
    }

    # 退出
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
        remove_country_flag = engaged_with_pantsu_shop
    }
}

#三级菜单 - 分类兑换修正 - 工业系修正
country_event = {
	id = wsgranking.1020
	title = pantsu_shop_name
	desc = wsgranking.1020.desc
    desc = {
        exclusive_trigger = { has_country_flag = pantsu_shop_origin }
        text = wsgranking.1020.desc.b
    }
	custom_gui = "enclave_caravaneer_window"
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		# room 有需求的话自己改名字
		room = Martes_room
	}
	trigger = {
		NOT = {
			has_global_flag = pantsu_shop_disabled
		}
	}
	option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_primary_industry
        trigger = { NOT = { has_modifier = wg_modifier_primary_industry }}
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 30 }
				fail_text = too_low_rank_fail_30
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
			}
			resource_stockpile_compare = { resource = energy value >= 2000 }
		}
		default_pantsu_shop_buff_effects = { eventID = 1020 }
        set_country_flag = wg_modifier_primary_industry
        add_resource = { energy = -2000 }
		add_modifier = { modifier = wg_modifier_primary_industry days = 7200 }
	}
	#胖次之星
	option = {
		custom_gui = "enclave_caravaneer_option"
        name = building_shop_pantsu_star
		custom_tooltip = building_shop_pantsu_star_desc
		custom_tooltip = not_count_in_buff_limit
        trigger = { 
			NOT = { 
				has_country_flag = pantsu_shop_pantsu_star_allowed
			}
			has_origin = origin_wg_shop
		}
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 40 }
                fail_text = too_low_rank_fail_40
			}
            resource_stockpile_compare = { resource = energy value >= 2000 }
		}
        add_resource = { energy = -2000 }
		set_country_flag = pantsu_shop_pantsu_star_allowed
        hidden_effect = { country_event = { id = wsgranking.1020 }}
	}
	option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_secondary_industry
        trigger = { NOT = { has_modifier = wg_modifier_secondary_industry }}
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 40 }
				fail_text = too_low_rank_fail_40
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
			}
			resource_stockpile_compare = { resource = energy value >= 3000 }
		}
		default_pantsu_shop_buff_effects = { eventID = 1020 }
        set_country_flag = wg_modifier_secondary_industry
        add_resource = { energy = -3000 }
		add_modifier = { modifier = wg_modifier_secondary_industry days = 7200 }
	}
	option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_tertiary_industry
        trigger = { NOT = { has_modifier = wg_modifier_tertiary_industry }}
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 50 }
				fail_text = too_low_rank_fail_50
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
			}
			resource_stockpile_compare = { resource = energy value >= 3000 }
		}
        default_pantsu_shop_buff_effects = { eventID = 1020 }
        set_country_flag = wg_modifier_tertiary_industry
        add_resource = { energy = -3000 }
		add_modifier = { modifier = wg_modifier_tertiary_industry days = 7200 }
	}	
	option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_planetary_construction
        trigger = { NOT = { has_modifier = wg_modifier_planetary_construction }}
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 50 }
				fail_text = too_low_rank_fail_50
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
			}
			resource_stockpile_compare = { resource = energy value >= 3000 }
		}
		default_pantsu_shop_buff_effects = { eventID = 1020 }
        set_country_flag = wg_modifier_planetary_construction
        add_resource = { energy = -3000 }
		add_modifier = { modifier = wg_modifier_planetary_construction days = 7200 }
	}
    option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_decision
        trigger = { NOT = { has_modifier = wg_modifier_decision }}
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 40 }
				fail_text = too_low_rank_fail_40
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
			}
			resource_stockpile_compare = { resource = energy value >= 3000 }
		}
		default_pantsu_shop_buff_effects = { eventID = 1020 }
        set_country_flag = wg_modifier_decision
        add_resource = { energy = -3000 }
		add_modifier = { modifier = wg_modifier_decision days = 7200 }
	}
    option = {
		custom_gui = "enclave_caravaneer_option" 
        name = wg_modifier_megastructure_construction 
        trigger = { NOT = { has_modifier = wg_modifier_megastructure_construction }}
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 100 }
				fail_text = too_low_rank_fail_100
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
			}
			resource_stockpile_compare = { resource = energy value >= 3500 }
		}
		default_pantsu_shop_buff_effects = { eventID = 1020 }
        set_country_flag = wg_modifier_megastructure_construction
        add_resource = { energy = -3500 }
		add_modifier = { modifier = wg_modifier_megastructure_construction days = 7200 }
	}
    option = {
		custom_gui = "enclave_caravaneer_option" 
        name = wg_modifier_megastructure_pruduction
        trigger = { NOT = { has_modifier = wg_modifier_megastructure_pruduction }}
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 100 }
				fail_text = too_low_rank_fail_100
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
			}
			resource_stockpile_compare = { resource = energy value >= 3500 }
		}
		default_pantsu_shop_buff_effects = { eventID = 1020 }
        set_country_flag = wg_modifier_megastructure_pruduction
        add_resource = { energy = -3500 }
		add_modifier = { modifier = wg_modifier_megastructure_pruduction days = 7200 }
    }

    # 返回一级菜单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_menu
        hidden_effect = { country_event = { id = wsgranking.1007 }}
    }

    # 返回主选单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_main
        hidden_effect = { country_event = { id = wsgranking.1001 }}
    }
    # 退出
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
        remove_country_flag = engaged_with_pantsu_shop
    }
}

#三级菜单 - 兑换修正 - 外交系修正
country_event = {
	id = wsgranking.1021
	title = pantsu_shop_name
	desc = wsgranking.1021.desc
    desc = {
        exclusive_trigger = { has_country_flag = pantsu_shop_origin }
        text = wsgranking.1021.desc.b
    }
	custom_gui = "enclave_caravaneer_window"
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		# room 有需求的话自己改名字
		room = Martes_room
	}
	trigger = {
		NOT = {
			has_global_flag = pantsu_shop_disabled
		}
	}
    option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_diplomacy_hostile
        trigger = { NOT = { has_modifier = wg_modifier_diplomacy_hostile }}
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 25 }
				fail_text = too_low_rank_fail_25
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
			}
			resource_stockpile_compare = { resource = energy value >= 1000 }
        }
        default_pantsu_shop_buff_effects = { eventID = 1021 }
        set_country_flag = wg_modifier_diplomacy_hostile
        add_resource = { energy = -1000 }
		add_modifier = { modifier = wg_modifier_diplomacy_hostile days = 7200 }
	}
	#VIP移民协议
	option = {
		custom_gui = "enclave_caravaneer_option"
		custom_tooltip = not_count_in_buff_limit
		custom_tooltip = wg_shop_immigration_modifier_desc
        name = wg_shop_immigration_modifier
        trigger = { 
			NOT = { 
				has_country_flag = pantsu_shop_immigration_modifier
			}
			has_origin = origin_wg_shop
		}
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 30 }
                fail_text = too_low_rank_fail_30
			}
            resource_stockpile_compare = { resource = energy value >= 2000 }
		}
        add_resource = { energy = -2000 }
		set_country_flag = pantsu_shop_immigration_modifier
		add_modifier = { modifier = wg_shop_immigration_modifier days = 14400 }
        hidden_effect = { country_event = { id = wsgranking.1020 }}
	}
    option = {
		custom_gui = "enclave_caravaneer_option" 
        name = wg_modifier_diplomacy_weight 
        trigger = { NOT = { has_modifier = wg_modifier_diplomacy_weight }}
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 50 }
				fail_text = too_low_rank_fail_50
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
            }
            resource_stockpile_compare = { resource = energy value >= 1000 }
		}
        default_pantsu_shop_buff_effects = { eventID = 1021 }
        set_country_flag = wg_modifier_diplomacy_weight
        add_resource = { energy = -1000 }
		add_modifier = { modifier = wg_modifier_diplomacy_weight days = 7200 }
	}
    option = {
		custom_gui = "enclave_caravaneer_option" 
        name = wg_modifier_diplomacy_envoy 
        trigger = { NOT = { has_modifier = wg_modifier_diplomacy_envoy }}
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 70 }
				fail_text = too_low_rank_fail_70
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
            }
            resource_stockpile_compare = { resource = energy value >= 1000 }
		}
        default_pantsu_shop_buff_effects = { eventID = 1021 }
        set_country_flag = wg_modifier_diplomacy_envoy
        add_resource = { energy = -2000 }
		add_modifier = { modifier = wg_modifier_diplomacy_envoy days = 7200 }
	}
    option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_diplomacy_trade
        trigger = { NOT = { has_modifier = wg_modifier_diplomacy_trade }}
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 100 }
                fail_text = too_low_rank_fail_100
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
            }
            resource_stockpile_compare = { resource = energy value >= 1000 }
		}
        default_pantsu_shop_buff_effects = { eventID = 1021 }
        set_country_flag = wg_modifier_diplomacy_trade
        add_resource = { alloys = -3000 }
		add_modifier = { modifier = wg_modifier_diplomacy_trade days = 7200 }
	}
	# 返回一级菜单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_menu
        hidden_effect = { country_event = { id = wsgranking.1007 }}
    }

    # 返回主选单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_main
        hidden_effect = { country_event = { id = wsgranking.1001 }}
    }
    # 退出
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
        remove_country_flag = engaged_with_pantsu_shop
    }
}

#三级菜单 - 兑换修正 - 军事系修正
country_event = {
	id = wsgranking.1022
	title = pantsu_shop_name
	desc = wsgranking.1022.desc
    desc = {
        exclusive_trigger = { has_country_flag = pantsu_shop_origin }
        text = wsgranking.1022.desc.b
    }
	custom_gui = "enclave_caravaneer_window"
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		# room 有需求的话自己改名字
		room = Martes_room
	}
	trigger = {
		NOT = {
			has_global_flag = pantsu_shop_disabled
		}
    }

    immediate = {
        if = {
            limit = { years_passed >= 200 }
            set_variable = { which = rankpts_require value = 250 }
            break = yes
        }
        if = {
            limit = { years_passed >= 100 }
            set_variable = { which = rankpts_require value = 120 }
            break = yes
        }
        if = {
            limit = { years_passed >= 50 }
            set_variable = { which = rankpts_require value = 60 }
            break = yes
        }
    }
 	option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_station_gatherers
        trigger = { NOT = { has_modifier = wg_modifier_station_gatherers }}
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 20 }
                fail_text = too_low_rank_fail_20
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
            }
            resource_stockpile_compare = { resource = energy value >= 500 }
        }
        default_pantsu_shop_buff_effects = { eventID = 1022 }
        set_country_flag = wg_modifier_station_gatherers
        add_resource = { energy = -500 }
		add_modifier = { modifier = wg_modifier_station_gatherers days = 7200 } 
    }	
 	option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_survey
        trigger = { NOT = { has_modifier = wg_modifier_survey }}
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 20 }
                fail_text = too_low_rank_fail_20
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
            }
            resource_stockpile_compare = { resource = energy value >= 500 }
		}
        default_pantsu_shop_buff_effects = { eventID = 1022 }
        set_country_flag = wg_modifier_survey
        add_resource = { energy = -500 }
		add_modifier = { modifier = wg_modifier_survey days = 7200 } 
    }
 	option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_ship_repair
        trigger = { NOT = { has_modifier = wg_modifier_ship_repair }}
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 20 }
                fail_text = too_low_rank_fail_20
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
            }
            resource_stockpile_compare = { resource = energy value >= 500 }
		}
        default_pantsu_shop_buff_effects = { eventID = 1022 }
        set_country_flag = wg_modifier_ship_repair
        add_resource = { energy = -500 }
		add_modifier = { modifier = wg_modifier_ship_repair days = 7200 } 
    } 	
 	option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_ship_speed
        trigger = { NOT = { has_modifier = wg_modifier_ship_speed }}
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 20 }
                fail_text = too_low_rank_fail_20
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
            }
            resource_stockpile_compare = { resource = energy value >= 500 }
		}
        default_pantsu_shop_buff_effects = { eventID = 1022 }
        set_country_flag = wg_modifier_ship_speed
        add_resource = { energy = -500 }
		add_modifier = { modifier = wg_modifier_ship_speed days = 7200 }
    }   
	option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_combat_elite_pilot
        trigger = { NOT = { has_modifier = wg_modifier_combat_elite_pilot }}
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 30 }
                fail_text = too_low_rank_fail_30
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
            }
            resource_stockpile_compare = { resource = energy value >= 1000 }
		}
        default_pantsu_shop_buff_effects = { eventID = 1022 }
        set_country_flag = wg_modifier_combat_elite_pilot
        add_resource = { energy = -1000 }
		add_modifier = { modifier = wg_modifier_combat_elite_pilot days = 7200 }
    }
	option = {#星际烤肉
		custom_gui = "enclave_caravaneer_option"
        name = mega_space_kebab_center
        trigger = { 
			NOR = { 
				has_technology = tech_space_kebab_center 
                has_tech_option = tech_space_kebab_center
			}
		}
		allow = {
			resource_stockpile_compare = { resource = energy value >= 3000 }
			resource_stockpile_compare = { resource = sr_pantsu value >= 300 }
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 40 }
                fail_text = too_low_rank_fail_40
			}
		}
        custom_tooltip = "wg_kebab_center_02_DESC"
		add_resource = { energy = -3000 }
		add_resource = { sr_pantsu = -300 }
		give_technology = { tech = tech_space_kebab_center }
        hidden_effect = { country_event = { id = wsgranking.1022 }}
	}
	option = {#聚合生产阵列
		custom_gui = "enclave_caravaneer_option"
        name = mega_wg_polymer_matrix
        trigger = { 
			NOR = { 
				has_technology = tech_wg_polymer_matrix 
                has_tech_option = tech_wg_polymer_matrix
			}
		}
		allow = {
			has_ascension_perk = ap_wsg_station
			resource_stockpile_compare = { resource = energy value >= 12000 }
			resource_stockpile_compare = { resource = sr_pantsu value >= 600 }
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 60 }
                fail_text = too_low_rank_fail_60
			}
		}
        custom_tooltip = "tech_wg_polymer_matrix_desc"
		add_resource = { energy = -12000 }
		add_resource = { sr_pantsu = -600 }
		give_technology = { tech = tech_wg_polymer_matrix }
        hidden_effect = { country_event = { id = wsgranking.1022 }}
	}
    option = {#VIP锚地
		custom_gui = "enclave_caravaneer_option"
		custom_tooltip = not_count_in_buff_limit
		custom_tooltip = tech_wg_shop_anchorage_desc
        name = tech_wg_shop_anchorage
        trigger = { 
			NOT = { 
				has_technology = tech_wg_shop_anchorage 
			}
			has_origin = origin_wg_shop
		}
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 40 }
                fail_text = too_low_rank_fail_40
			}
            resource_stockpile_compare = { resource = energy value >= 3000 }
			resource_stockpile_compare = { resource = sr_pantsu value >= 300 }
		}
        add_resource = { energy = -3000 }
		add_resource = { sr_pantsu = -300 }
		give_technology = { tech = tech_wg_shop_anchorage }
        hidden_effect = { country_event = { id = wsgranking.1022 }}
    }
    option = {#恒星基地模块
		custom_gui = "enclave_caravaneer_option"
		custom_tooltip = not_count_in_buff_limit
        name = tech_wg_spaceport_module_assembly
        trigger = { NOT = { has_technology = tech_wg_spaceport_module_assembly }}
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 50 }
                fail_text = too_low_rank_fail_50
			}
            resource_stockpile_compare = { resource = energy value >= 5000 }
			resource_stockpile_compare = { resource = sr_pantsu value >= 500 }
		}
        add_resource = { energy = -5000 }
		add_resource = { sr_pantsu = -500 }
		give_technology = { tech = tech_wg_spaceport_module_assembly }
        hidden_effect = { country_event = { id = wsgranking.1022 }}
    }
    option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_combat_hull_algorithm
        trigger = { NOT = { has_modifier = wg_modifier_combat_hull_algorithm }}
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 50 }
                fail_text = too_low_rank_fail_50
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
            }
            resource_stockpile_compare = { resource = energy value >= 1000 }
		}
        default_pantsu_shop_buff_effects = { eventID = 1022 }
        set_country_flag = wg_modifier_combat_hull_algorithm
        add_resource = { energy = -2000 }
		add_modifier = { modifier = wg_modifier_combat_hull_algorithm days = 7200 }
    }
    option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_combat_shipcraft
        trigger = { NOT = { has_modifier = wg_modifier_combat_shipcraft }}
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 70 }
                fail_text = too_low_rank_fail_70
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
            }
            resource_stockpile_compare = { resource = energy value >= 3000 }
		}
        default_pantsu_shop_buff_effects = { eventID = 1022 }
        set_country_flag = wg_modifier_combat_shipcraft
        add_resource = { energy = -3000 }
		add_modifier = { modifier = wg_modifier_combat_shipcraft days = 7200 }
    }
    option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_combat_fleet_control2
        trigger = { NOT = { has_modifier = wg_modifier_combat_fleet_control2 }}
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 165 }
                fail_text = too_low_rank_fail_165
            }
            # custom_tooltip = {
            #     check_variable = { which = max_allowed_shop_buffs value > 0 }
            #     fail_text = reached_max_allowed_shop_buffs
            # }
            resource_stockpile_compare = { resource = energy value >= 10000 }
			resource_stockpile_compare = { resource = sr_pantsu value >= 3000 }
		}
        add_resource = { 
			energy = -10000 
			sr_pantsu = -3000
		}
        add_modifier = { modifier = wg_modifier_combat_fleet_control2 }
        custom_tooltip = not_count_in_buff_limit
        hidden_effect = { country_event = { id = wsgranking.1022 }}
    }    
    option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_combat_uf
        trigger = {
            has_global_flag = wg_invasion_happened
            NOT = { has_modifier = wg_modifier_combat_uf }
        }
		allow = {
            custom_tooltip = {
                check_variable = { which = "rankpts" value >= rankpts_require }
                fail_text = rankpts_not_reach_requirment
            }
            resource_stockpile_compare = { resource = energy value >= 3000 }
            resource_stockpile_compare = { resource = sr_pantsu value >= 500 }
		}
        add_resource = { energy = -3000 sr_pantsu = -1000 }
        add_modifier = { modifier = wg_modifier_combat_uf }
        custom_tooltip = not_count_in_buff_limit
        hidden_effect = { country_event = { id = wsgranking.1022 }}
	}
    
	# 返回一级菜单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_menu
        hidden_effect = { country_event = { id = wsgranking.1007 }}
    }

    # 返回主选单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_main
        hidden_effect = { country_event = { id = wsgranking.1001 }}
    }
    # 退出
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
        remove_country_flag = engaged_with_pantsu_shop
    }
}

# 其他国家收到被摧毁消息
country_event = {
	id = wsgranking.2001
	title = wsgranking.2001.title
	desc = wsgranking.2001.desc
	picture = GFX_evt_space_debris
	show_sound = event_ship_bridge
	location = fromfromfrom

	is_triggered_only = yes

	option = {
		name = UNFORTUNATE
	}

	option = {
		name = EXCELLENT
		exclusive_trigger = { 
            is_homicidal = yes 
        }
	}
}

# buff到期提醒续约
country_event = {
	id = wsgranking.1200
    title = pantsu_shop_name
	desc = wsgranking.1200.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
    is_triggered_only = yes
    picture_event_data = {
		# room 有需求的话自己改名字
		room = Martes_room
	}
    
    trigger = {
        NOR = { 
            has_country_flag = wsgranking1200 
            has_global_flag = pantsu_shop_disabled
        }
    }
    immediate = {
        set_country_flag = wsgranking1200
    }

    # 工业系修正
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_primary_industry
        trigger = {
            NOT = { has_modifier = wg_modifier_primary_industry }
            has_country_flag = wg_modifier_primary_industry
        }
        allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 30 }
				fail_text = too_low_rank_fail_30
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
			}
			resource_stockpile_compare = { resource = energy value >= 2000 }
		}
		default_pantsu_shop_buff_effects = yes
        add_resource = { energy = -2000 }
        add_modifier = { modifier = wg_modifier_primary_industry days = 7200 }
        is_dialog_only = yes
        response_text = wsgranking.1200.desc
    }
    option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_secondary_industry
        trigger = { 
            NOT = { has_modifier = wg_modifier_secondary_industry }
            has_country_flag = wg_modifier_secondary_industry
        }
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 50 }
				fail_text = too_low_rank_fail_50
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
			}
			resource_stockpile_compare = { resource = energy value >= 3000 }
		}
		default_pantsu_shop_buff_effects = yes
        add_resource = { energy = -3000 }
        add_modifier = { modifier = wg_modifier_secondary_industry days = 7200 }
        is_dialog_only = yes
        response_text = wsgranking.1200.desc
    }
    option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_tertiary_industry
        trigger = { 
            NOT = { has_modifier = wg_modifier_tertiary_industry }
            has_country_flag = wg_modifier_tertiary_industry
        }
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 50 }
				fail_text = too_low_rank_fail_50
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
			}
			resource_stockpile_compare = { resource = energy value >= 3000 }
		}
		default_pantsu_shop_buff_effects = yes
        add_resource = { energy = -3000 }
        add_modifier = { modifier = wg_modifier_tertiary_industry days = 7200 }
        is_dialog_only = yes
        response_text = wsgranking.1200.desc
    }
    option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_planetary_construction
        trigger = { 
            NOT = { has_modifier = wg_modifier_planetary_construction }
            has_country_flag = wg_modifier_planetary_construction
        }
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 50 }
				fail_text = too_low_rank_fail_50
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
			}
			resource_stockpile_compare = { resource = energy value >= 3000 }
		}
		default_pantsu_shop_buff_effects = yes
        add_resource = { energy = -3000 }
        add_modifier = { modifier = wg_modifier_planetary_construction days = 7200 }
        is_dialog_only = yes
        response_text = wsgranking.1200.desc
    }
    option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_decision
        trigger = { 
            NOT = { has_modifier = wg_modifier_decision }
            has_country_flag = wg_modifier_decision
        }
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 50 }
				fail_text = too_low_rank_fail_50
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
			}
			resource_stockpile_compare = { resource = energy value >= 3000 }
		}
		default_pantsu_shop_buff_effects = yes
        add_resource = { energy = -3000 }
        add_modifier = { modifier = wg_modifier_decision days = 7200 }
        is_dialog_only = yes
        response_text = wsgranking.1200.desc
    }
    option = {
		custom_gui = "enclave_caravaneer_option" 
        name = wg_modifier_megastructure_construction 
        trigger = { 
            NOT = { has_modifier = wg_modifier_megastructure_construction }
            has_country_flag = wg_modifier_megastructure_construction
        }
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 90 }
				fail_text = too_low_rank_fail_90
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
			}
			resource_stockpile_compare = { resource = energy value >= 3500 }
		}
		default_pantsu_shop_buff_effects = yes
        add_resource = { energy = -3500 }
        add_modifier = { modifier = wg_modifier_megastructure_construction days = 7200 }
        is_dialog_only = yes
        response_text = wsgranking.1200.desc
    }
    option = {
		custom_gui = "enclave_caravaneer_option" 
        name = wg_modifier_megastructure_pruduction
        trigger = { 
            NOT = { has_modifier = wg_modifier_megastructure_pruduction }
            has_country_flag = wg_modifier_megastructure_pruduction
        }
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 90 }
				fail_text = too_low_rank_fail_90
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
			}
			resource_stockpile_compare = { resource = energy value >= 3500 }
		}
		default_pantsu_shop_buff_effects = yes
        add_resource = { energy = -3500 }
        add_modifier = { modifier = wg_modifier_megastructure_pruduction days = 7200 }
        is_dialog_only = yes
        response_text = wsgranking.1200.desc
    }
    # 外交系修正
    option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_diplomacy_hostile
        trigger = { 
            NOT = { has_modifier = wg_modifier_diplomacy_hostile }
            has_country_flag = wg_modifier_diplomacy_hostile
        }
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 30 }
				fail_text = too_low_rank_fail_30
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
			}
			resource_stockpile_compare = { resource = energy value >= 1000 }
        }
        default_pantsu_shop_buff_effects = yes
        add_resource = { energy = -1000 }
        add_modifier = { modifier = wg_modifier_diplomacy_hostile days = 7200 }
        is_dialog_only = yes
        response_text = wsgranking.1200.desc
    }
    option = {
		custom_gui = "enclave_caravaneer_option" 
        name = wg_modifier_diplomacy_weight 
        trigger = { 
            NOT = { has_modifier = wg_modifier_diplomacy_weight }
            has_country_flag = wg_modifier_diplomacy_weight
        }
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 50 }
				fail_text = too_low_rank_fail_50
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
            }
            resource_stockpile_compare = { resource = energy value >= 1000 }
		}
        default_pantsu_shop_buff_effects = yes
        add_resource = { energy = -1000 }
        add_modifier = { modifier = wg_modifier_diplomacy_weight days = 7200 }
        is_dialog_only = yes
        response_text = wsgranking.1200.desc
    }
    option = {
		custom_gui = "enclave_caravaneer_option" 
        name = wg_modifier_diplomacy_envoy 
        trigger = { 
            NOT = { has_modifier = wg_modifier_diplomacy_envoy }
            has_country_flag = wg_modifier_diplomacy_envoy
        }
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 70 }
				fail_text = too_low_rank_fail_70
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
            }
            resource_stockpile_compare = { resource = energy value >= 1000 }
		}
        default_pantsu_shop_buff_effects = yes
        add_resource = { energy = -2000 }
        add_modifier = { modifier = wg_modifier_diplomacy_envoy days = 7200 }
        is_dialog_only = yes
        response_text = wsgranking.1200.desc
    }
    option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_diplomacy_trade
        trigger = { 
            NOT = { has_modifier = wg_modifier_diplomacy_trade }
            has_country_flag = wg_modifier_diplomacy_trade
        }
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 90 }
                fail_text = too_low_rank_fail_90
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
            }
            resource_stockpile_compare = { resource = energy value >= 1000 }
		}
        default_pantsu_shop_buff_effects = yes
        add_resource = { alloys = -3000 }
        add_modifier = { modifier = wg_modifier_diplomacy_trade days = 7200 }
        is_dialog_only = yes
        response_text = wsgranking.1200.desc
    }
    # 军事系修正
    option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_station_gatherers
        trigger = { 
            NOT = { has_modifier = wg_modifier_station_gatherers }
            has_country_flag = wg_modifier_station_gatherers
        }
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 20 }
                fail_text = too_low_rank_fail_20
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
            }
            resource_stockpile_compare = { resource = energy value >= 500 }
        }
        default_pantsu_shop_buff_effects = yes
        add_resource = { energy = -500 }
        add_modifier = { modifier = wg_modifier_station_gatherers days = 7200 }
        is_dialog_only = yes
        response_text = wsgranking.1200.desc
    }
    option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_survey
        trigger = { 
            NOT = { has_modifier = wg_modifier_survey }
            has_country_flag = wg_modifier_survey
        }
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 20 }
                fail_text = too_low_rank_fail_20
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
            }
            resource_stockpile_compare = { resource = energy value >= 500 }
		}
        default_pantsu_shop_buff_effects = yes
        add_resource = { energy = -500 }
        add_modifier = { modifier = wg_modifier_survey days = 7200 }
        is_dialog_only = yes
        response_text = wsgranking.1200.desc
    }
    option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_ship_repair
        trigger = { 
            NOT = { has_modifier = wg_modifier_ship_repair }
            has_country_flag = wg_modifier_ship_repair
        }
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 20 }
                fail_text = too_low_rank_fail_20
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
            }
            resource_stockpile_compare = { resource = energy value >= 500 }
		}
        default_pantsu_shop_buff_effects = yes
        add_resource = { energy = -500 }
		add_modifier = { modifier = wg_modifier_ship_repair days = 7200 }
        is_dialog_only = yes
        response_text = wsgranking.1200.desc
    }
    option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_ship_speed
        trigger = { 
            NOT = { has_modifier = wg_modifier_ship_speed }
            has_country_flag = wg_modifier_ship_speed
        }
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 20 }
                fail_text = too_low_rank_fail_20
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
            }
            resource_stockpile_compare = { resource = energy value >= 500 }
		}
        default_pantsu_shop_buff_effects = yes
        add_resource = { energy = -500 }
		add_modifier = { modifier = wg_modifier_ship_speed days = 7200 }
        is_dialog_only = yes
        response_text = wsgranking.1200.desc
    }
    option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_combat_elite_pilot
        trigger = { 
            NOT = { has_modifier = wg_modifier_combat_elite_pilot }
            has_country_flag = wg_modifier_combat_elite_pilot
        }
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 30 }
                fail_text = too_low_rank_fail_30
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
            }
            resource_stockpile_compare = { resource = energy value >= 1000 }
		}
        default_pantsu_shop_buff_effects = yes
        add_resource = { energy = -1000 }
		add_modifier = { modifier = wg_modifier_combat_elite_pilot days = 7200 }
        is_dialog_only = yes
        response_text = wsgranking.1200.desc
    }
    option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_combat_hull_algorithm
        trigger = { 
            NOT = { has_modifier = wg_modifier_combat_hull_algorithm }
            has_country_flag = wg_modifier_combat_hull_algorithm
        }
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 50 }
                fail_text = too_low_rank_fail_50
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
            }
            resource_stockpile_compare = { resource = energy value >= 1000 }
		}
        default_pantsu_shop_buff_effects = yes
        add_resource = { energy = -2000 }
		add_modifier = { modifier = wg_modifier_combat_hull_algorithm days = 7200 }
        is_dialog_only = yes
        response_text = wsgranking.1200.desc
    }
    option = {
		custom_gui = "enclave_caravaneer_option"
        name = wg_modifier_combat_shipcraft
        trigger = { 
            NOT = { has_modifier = wg_modifier_combat_shipcraft }
            has_country_flag = wg_modifier_combat_shipcraft
        }
		allow = {
			custom_tooltip = {
				check_variable = { which = "rankpts" value >= 70 }
                fail_text = too_low_rank_fail_70
			}
			custom_tooltip = {
				check_variable = { which = max_allowed_shop_buffs value > 0 }
                fail_text = reached_max_allowed_shop_buffs
            }
            resource_stockpile_compare = { resource = energy value >= 3000 }
		}
        default_pantsu_shop_buff_effects = yes
        add_resource = { energy = -3000 }
		add_modifier = { modifier = wg_modifier_combat_shipcraft days = 7200 }
        is_dialog_only = yes
        response_text = wsgranking.1200.desc
    }

    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1200.a
        hidden_effect = {
            remove_country_flag = wsgranking1200
            if = {
                limit = {
                    NOT = { has_modifier = wg_modifier_primary_industry }
                    has_country_flag = wg_modifier_primary_industry
                }
                remove_country_flag = wg_modifier_primary_industry
            }
            if = {
                limit = {
                    NOT = { has_modifier = wg_modifier_secondary_industry }
                    has_country_flag = wg_modifier_secondary_industry
                }
                remove_country_flag = wg_modifier_secondary_industry
            }
            if = {
                limit = {
                    NOT = { has_modifier = wg_modifier_tertiary_industry }
                    has_country_flag = wg_modifier_tertiary_industry
                }
                remove_country_flag = wg_modifier_tertiary_industry
            }
            if = {
                limit = {
                    NOT = { has_modifier = wg_modifier_planetary_construction }
                    has_country_flag = wg_modifier_planetary_construction
                }
                remove_country_flag = wg_modifier_planetary_construction
            }
            if = {
                limit = {
                    NOT = { has_modifier = wg_modifier_decision }
                    has_country_flag = wg_modifier_decision
                }
                remove_country_flag = wg_modifier_decision
            }
            if = {
                limit = {
                    NOT = { has_modifier = wg_modifier_megastructure_construction }
                    has_country_flag = wg_modifier_megastructure_construction
                }
                remove_country_flag = wg_modifier_megastructure_construction
            }
            if = {
                limit = {
                    NOT = { has_modifier = wg_modifier_megastructure_pruduction }
                    has_country_flag = wg_modifier_megastructure_pruduction
                }
                remove_country_flag = wg_modifier_megastructure_pruduction
            }
            if = {
                limit = {
                    NOT = { has_modifier = wg_modifier_diplomacy_hostile }
                    has_country_flag = wg_modifier_diplomacy_hostile
                }
                remove_country_flag = wg_modifier_diplomacy_hostile
            }
            if = {
                limit = {
                    NOT = { has_modifier = wg_modifier_diplomacy_weight }
                    has_country_flag = wg_modifier_diplomacy_weight
                }
                remove_country_flag = wg_modifier_diplomacy_weight
            }
            if = {
                limit = {
                    NOT = { has_modifier = wg_modifier_diplomacy_envoy }
                    has_country_flag = wg_modifier_diplomacy_envoy
                }
                remove_country_flag = wg_modifier_diplomacy_envoy
            }
            if = {
                limit = {
                    NOT = { has_modifier = wg_modifier_diplomacy_trade }
                    has_country_flag = wg_modifier_diplomacy_trade
                }
                remove_country_flag = wg_modifier_diplomacy_trade
            }
            if = {
                limit = {
                    NOT = { has_modifier = wg_modifier_station_gatherers }
                    has_country_flag = wg_modifier_station_gatherers
                }
                remove_country_flag = wg_modifier_station_gatherers
            }
            if = {
                limit = {
                    NOT = { has_modifier = wg_modifier_survey }
                    has_country_flag = wg_modifier_survey
                }
                remove_country_flag = wg_modifier_survey
            }
            if = {
                limit = {
                    NOT = { has_modifier = wg_modifier_ship_repair }
                    has_country_flag = wg_modifier_ship_repair
                }
                remove_country_flag = wg_modifier_ship_repair
            }
            if = {
                limit = {
                    NOT = { has_modifier = wg_modifier_ship_speed }
                    has_country_flag = wg_modifier_ship_speed
                }
                remove_country_flag = wg_modifier_ship_speed
            }
            if = {
                limit = {
                    NOT = { has_modifier = wg_modifier_combat_elite_pilot }
                    has_country_flag = wg_modifier_combat_elite_pilot
                }
                remove_country_flag = wg_modifier_combat_elite_pilot
            }
            if = {
                limit = {
                    NOT = { has_modifier = wg_modifier_combat_hull_algorithm }
                    has_country_flag = wg_modifier_combat_hull_algorithm
                }
                remove_country_flag = wg_modifier_combat_hull_algorithm
            }
            if = {
                limit = {
                    NOT = { has_modifier = wg_modifier_combat_shipcraft }
                    has_country_flag = wg_modifier_combat_shipcraft
                }
                remove_country_flag = wg_modifier_combat_shipcraft
            }
        }
        default_hide_option = yes
    }
}
    


# 有商店通讯之后随机被动增加军阶
country_event = {
	id = wsgranking.5000
	hide_window = yes
	mean_time_to_happen = {
		days = 720
	}
	trigger = {
		has_communications = event_target:pantsu_shop_country
		NOT = {
			has_country_flag = recent_rank_increment
		}
        NOT = { has_global_flag = pantsu_shop_disabled }
	}
	immediate = {
		set_timed_country_flag = {
			flag = recent_rank_increment
			days = 720
		}
	
	    random_list = {
            4 = {
                change_variable = {
                    which = rankpts
                    value = 2
                }
            }

            6 = {
                change_variable = {
                    which = rankpts
                    value = 1
                }
            }

            10 = {
            }
        }	
    }
}
# 任务增加军阶点（实验性）
#征集员工 - 1人口，4点数
country_event = {
	id = wsgranking.5001
	title = pantsu_shop_name
	desc = wsgranking.5001.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
    #is_triggered_only = yes
    picture_event_data = {
        room = Shop_room
    }
	
	mean_time_to_happen = {
		years = 30
		modifier = {
			factor = 1.2
			z_mod_num_pop_trigger = { OPERATOR = ">" NUM = 100 }
		}
		modifier = {
			factor = 1.2
			z_mod_num_pop_trigger = { OPERATOR = ">" NUM = 80 }
		}
		modifier = {
			factor = 1.2
			z_mod_num_pop_trigger = { OPERATOR = ">" NUM = 60 }
		}
		modifier = {
			factor = 1.2
			z_mod_num_pop_trigger = { OPERATOR = ">" NUM = 40 }
		}
		modifier = {
			factor = 0.5
			z_mod_num_pop_trigger = { OPERATOR = "<" NUM = 30 }
		}
		modifier = {
			factor = 0.5
			z_mod_num_pop_trigger = { OPERATOR = "<" NUM = 20 }
		}
	}
	
	trigger = {
        NOT = { has_global_flag = pantsu_shop_disabled }
		z_mod_num_pop_trigger = { OPERATOR = ">" NUM = 10 }
        OR = {
			has_authority = auth_warshipgirls
			has_authority = auth_shenhai
		}
        has_communications = event_target:pantsu_shop_country
		NOR = {
			has_valid_civic = civic_machine_terminator
			has_valid_civic = civic_fanatic_purifiers
            is_wg_exterminate_goverment = yes
		}		
		is_at_war = no
		any_owned_planet = {
			z_mod_num_pop_trigger = { OPERATOR = ">" NUM = 1 }
			any_owned_pop = {
				is_same_species = root
			}
		}	
    }
	immediate = {	
		random_owned_planet = {
			limit = {
				z_mod_num_pop_trigger = { OPERATOR = ">" NUM = 1 }
				any_owned_pop = {
					is_same_species = root
				}
			}
			save_event_target_as = PantsuShopTaskPlanet
        }	
    }
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5001.a
        change_variable = {
            which = rankpts
            value = 4
        }
        add_modifier = {
            modifier = extended_payout_goodest
            days = 7200
        }
        hidden_effect = {
			event_target:PantsuShopTaskPlanet = {
				random_owned_pop = {
					limit = {
                    is_same_species = root
                    }
                    kill_pop = yes
                }	
		    }
        }
    }
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5001.b
        #custom_tooltip = "name.tooltip"
    }
}

# 战利品商店投资

country_event = {
	id = wsgranking.5002
	title = pantsu_shop_name
	desc = wsgranking.5002.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
    #is_triggered_only = yes
    picture_event_data = {
        room = Shop_room
    }
	
	mean_time_to_happen = {
        years = 30
        modifier = {
			factor = 1000
			AND = {
				resource_stockpile_compare = { resource = energy value <= 50000 }
				income < 500
			}
		}
		modifier = {
            factor = 0.8
            AND = {
                resource_stockpile_compare = { resource = energy value >= 10000 }
                income > 500
            }
		}
		modifier = {
			factor = 0.5
            AND = {
                resource_stockpile_compare = { resource = energy value >= 20000 }
                income > 1000
            }
        }
        modifier = {
			factor = 0.2
            AND = {
                resource_stockpile_compare = { resource = energy value >= 40000 }
                income > 2000
            }
        }
	}
	immediate = {
        set_timed_country_flag = {
            flag = pantsu_shop_loan_requested
            days = 7200
        }
    }
	trigger = {
        always = no
		num_pops > 10
        OR = {
			has_authority = auth_warshipgirls
			has_authority = auth_shenhai
		}
        has_communications = event_target:pantsu_shop_country
		NOR = {
			has_valid_civic = civic_machine_terminator
            has_valid_civic = civic_fanatic_purifiers
            has_country_flag = pantsu_shop_loan_requested
            has_global_flag = pantsu_shop_disabled 
		}		
		is_at_war = no
        resource_stockpile_compare = {
            resource = energy
            value = 5000
        }
    }
# 5年期5000投资，每月110
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5002.a
        allow = {
            resource_stockpile_compare = { resource = energy value >= 5000 }
        }
        change_variable = { which = rankpts value = 2 }
        add_modifier = { modifier = wg_shop_loan_5k days = 1800 }
        hidden_effect = { add_resource = { energy = -5000 }}
    }
#10年期10000投资，每月167
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5002.b
        allow = {
            resource_stockpile_compare = { resource = energy value >= 10000 }
        }
        change_variable = { which = rankpts value = 4 }
        add_modifier = { modifier = wg_shop_loan_10k days = 7200 }
        hidden_effect = { add_resource = { energy = -10000 }}
    }
#20年期30000投资，每月375
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5002.c
        allow = {
            resource_stockpile_compare = { resource = energy value >= 20000 }
        }
        change_variable = { which = rankpts value = 8 }
        add_modifier = { modifier = wg_shop_loan_30k days = 7200 }
        hidden_effect = { add_resource = { energy = -30000 }}
    }


    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5002.d
    }
}

# 市场拓展任务 - 要求特许经营
country_event = {
	id = wsgranking.5003
	title = pantsu_shop_name
	desc = wsgranking.5003.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
    #is_triggered_only = yes
    picture_event_data = {
        room = Shop_room
    }
	
	mean_time_to_happen = {
		years = 40
		modifier = {
			factor = 0.6
			any_owned_planet = {
                has_building = building_pantsu_shop
            }	
        }
        modifier = {
			factor = 0.4
			any_owned_planet = {
                AND = {
                has_building = building_pantsu_shop
                has_building = building_galactic_stock_exchange
                }
            }	
		}
	}
	
	trigger = {
        always = no
		num_pops > 10
        OR = {
			has_authority = auth_warshipgirls
			has_authority = auth_shenhai
		}
		NOR = {
			has_valid_civic = civic_machine_terminator
			has_valid_civic = civic_fanatic_purifiers
		}		
		NOT = { has_country_flag = pantsu_shop_franchising }
		#is_at_war = no
		
		any_owned_planet = {
			num_pops > 50
			any_owned_pop = {
				is_same_species = root
			}
		}	
	}
	
	immediate = {
		set_timed_country_flag = {
            flag = pantsu_shop_franchising
            days = 14400
        }
	
		random_owned_planet = {
            limit = {
				num_pops > 50
			    OR = {
                    has_building = building_pantsu_shop
                    has_building = building_commercial_zone
                    has_building = building_galactic_stock_exchange
                    has_building = building_commercial_megaplex
                }
			}
			save_event_target_as = pantsu_shop_franchising_planet
        }	
    }
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5003.a
        change_variable = {
            which = rankpts
            value = 8
        }
        hidden_effect = {
            add_resource = {
                energy = 2000
            }
        }
        event_target:pantsu_shop_franchising_planet = {
            add_modifier = {
                modifier = pantsu_shop_franchising
                days = -1
            }
        }
    }
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5003.b
    }
}


# 给断椅族改善伙食
country_event = {
	id = wsgranking.5004
	title = wsgranking.5004.title
	desc = wsgranking.5004.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
    #is_triggered_only = yes
    picture_event_data = {
        room = Ella_room
    }
	
	mean_time_to_happen = {
		years = 20
		modifier = {
			factor = 0.6
            has_technology = tech_food_processing_2

        }
	}
	
	trigger = {
        always = no
		is_gestalt = no
		is_mechanical_empire = no	
        is_country_type = default
        has_technology = tech_food_processing_1
        OR = {
			has_authority = auth_warshipgirls
			has_authority = auth_shenhai
		}
		NOR = {
			has_valid_civic = civic_machine_terminator
			has_valid_civic = civic_fanatic_purifiers
		}		
        NOT = {
            has_country_flag = pantsu_shop_food_granted
        }
		#is_at_war = no
	}
	
	immediate = {
        set_timed_country_flag = {
            flag = pantsu_shop_food_granted
            days = 7200
        }
    }
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5004.a
        change_variable = {
            which = rankpts
            value = 2
        }
        add_resource = {
            food = -1000
            volatile_motes = -50
        }
    }

    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5004.b
        change_variable = {
            which = rankpts
            value = 2
        }
        add_resource = {
            food = -1000
            exotic_gases = -50
        }
    }

    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5004.c
        change_variable = {
            which = rankpts
            value = 2
        }
        add_resource = {
            food = -1000
            minor_artifacts = -1
        }
    }
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5004.d
    }
}
#赠送奈拉总督
country_event = {
	id = wsgranking.5005
	title = wsgranking.5005.title
	desc = wsgranking.5005.desc
    picture = GFX_evt_wg_rabbit
	is_triggered_only = yes
	
	trigger = {
        is_mechanical_empire = no	
        is_default_country_wg = yes
        OR = {
			has_authority = auth_warshipgirls
			has_authority = auth_shenhai
		}
		NOR = {
            has_civic = civic_fanatic_purifiers
            has_ascension_perk = ap_shenhai_silent
            has_civic = civic_CM
            has_country_flag = get_naila
            has_global_flag = pantsu_shop_disabled 
		}		
		#is_at_war = no
    }
    
    immediate = {
        set_country_flag = get_naila
    }
	
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5005.a
        change_variable = {
            which = rankpts
            value = 2
        }
        hidden_effect = {		
            country_event = { id = wg_paragon.1 }
        }	
    }
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5005.b
        add_resource = {
            influence = 50
        }
    }

    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5005.c
        change_variable = {
            which = rankpts
            value = 2
        }
        add_resource = {
            food = 1
            energy = -1
        }
        hidden_effect = {		
            country_event = { id = wg_paragon.1 }
        }	
    }
}

country_event = {
	id = wsgranking.5006
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		create_species = {
            name = NAILA
            plural = NAILA
            class = ART
            portrait = art13
            namelist = ART1
            effect = {
                save_global_event_target_as = Naila_species
            }
		}		
		create_leader = {
			class = official
			species = event_target:Naila_species
			name = "NAME_NAILA"
			skill = 6
            set_age = 9
            gender = female
			traits = {
			    trait = leader_trait_official_naila
			    trait = leader_trait_official_chairman
			    # trait = leader_trait_official_affection
			}
			effect = {
			    set_leader_flag = wsg_event_leader
			}
			event_leader = yes	# prevents this leader from leading factions and winning elections
		}
		
		last_created_leader = {
			change_leader_portrait = cts9998
			set_variable = { which = affection value = 15 }
		}
	}
}

# #通知事件
# #通知阿尔法武器上架
# country_event = {
# 	id = wsgranking.6001
# 	title = pantsu_shop_name
# 	desc = wsgranking.6001.desc
# 	custom_gui = "enclave_caravaneer_window"
# 	diplomatic = yes
# 	is_triggered_only = yes
# 	picture_event_data = {
# 		room = Ella_room
# 	}
# 	trigger = {
# 		last_increased_tech = tech_wsg_203
#         NOT = { has_global_flag = pantsu_shop_disabled }
# 	}
# 	option = {
# 		custom_gui = "enclave_caravaneer_option"
# 		name = OK
# 	}
# }

# #通知深海武器上架
# country_event = {
# 	id = wsgranking.6002
# 	title = pantsu_shop_name
# 	desc = wsgranking.6002.desc
# 	custom_gui = "enclave_caravaneer_window"
# 	diplomatic = yes
# 	is_triggered_only = yes
# 	picture_event_data = {
# 		room = Ella_room
# 	}
# 	trigger = {
# 		last_increased_tech = tech_sh_Lweapon
#         NOT = { has_global_flag = pantsu_shop_disabled }
# 	}
# 	option = {
# 		custom_gui = "enclave_caravaneer_option"
# 		name = OK
# 	}
# }

#通知基因科技可以购买
# country_event = {
# 	id = wsgranking.6003
# 	title = pantsu_shop_name
# 	desc = wsgranking.6003.desc
# 	custom_gui = "enclave_caravaneer_window"
# 	diplomatic = yes
# 	is_triggered_only = yes
# 	picture_event_data = {
# 		room = Ella_room
# 	}
# 	trigger = {
# 		OR = {
# 			last_increased_tech = tech_sh_genetic_resequencing
# 			last_increased_tech = tech_wsg_genetic_resequencing
# 		}
#         NOT = { has_global_flag = pantsu_shop_disabled }
# 	}
# 	option = {
# 		custom_gui = "enclave_caravaneer_option"
# 		name = OK
#         give_technology = {
#             tech = tech_gene_tailoring
#         }
# 	}
# }

country_event = {
	id = wsgranking.6004
	title = pantsu_shop_name
	desc = wsgranking.6004.desc
	custom_gui = "enclave_caravaneer_window"
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		room = Ella_room
	}
	trigger = {
		years_passed >= 60
        resource_stockpile_compare = {
            resource = sr_living_metal
            value >=0
        }
        NOT = {
            has_technology = tech_mine_living_metal
        }
        NOT = { has_global_flag = pantsu_shop_disabled }
	}
	option = {
        give_technology = {
            tech = tech_mine_living_metal
        }
		custom_gui = "enclave_caravaneer_option"
		name = EXCELLENT
	}
}

#终极永久BUFF供货事件


#通知军阶点数达到某几个关键值



# 商店被摧毁
# Fleet 2 - Destroyed by Default country
country_event = {
	# This = owner of fleet 1 (combatant)
	# From = owner of fleet 2 (destroyed)
	# FromFrom = fleet 1
	# FromFromFrom = fleet 2
	# on_fleet_destroyed_perp 
	id = wsgranking.2000
	title = wsgranking.2000.title
	desc = wsgranking.2000.desc
	picture = GFX_evt_caravaneers
	show_sound = event_ship_thrusters
	location = fromfrom

	is_triggered_only = yes

	trigger = {
        fromfromfrom = { has_fleet_flag = pantsu_shop_guard }
	}

	immediate = {
        set_global_flag = pantsu_shop_disabled
        clear_global_event_target = pantsu_shop_system
        # 非舰娘国家击破触发重建事件
        if = {
            limit = {
                NOR = { # 非舰娘国家击破
                    has_authority = auth_warshipgirls
                    has_authority = auth_shenhai
                }
                any_country = { #检查是否有国家符合搬迁条件
                    has_communications = event_target:pantsu_shop_country
                    OR = {
                        has_authority = auth_warshipgirls
                        has_authority = auth_shenhai
                    }
                    NOR = { 
                        is_hostile = event_target:pantsu_shop_country
                        has_country_flag = asked_for_immigration
                    }
                    is_ai = no
                }
                NOT = { has_global_flag = pantsu_shop_rebuilt } # 不能重建两次
            }
            random_country = {
                limit = { #搜索最近的可重建星系
                    has_communications = event_target:pantsu_shop_country
                    OR = {
                        has_authority = auth_warshipgirls
                        has_authority = auth_shenhai
                    }
                    NOR = { 
                        is_hostile = event_target:pantsu_shop_country
                        has_country_flag = asked_for_immigration
                    }
                    is_ai = no #首先搜索玩家
				}
				country_event = { id = wsgranking.2002 } # days should be 60
			}
            every_playable_country = { #通知胖次商店被炸掉
                limit = {
                    has_communications = event_target:pantsu_shop_country
                    NOT = { is_same_value = root }
                }
                country_event = { id = wsgranking.2001 } # notification
            }
        }
        else = {
            every_playable_country = { #通知胖次商店被炸掉而且跑了
                limit = {
                    has_communications = root.from
                    NOT = { is_same_value = root }
                }
                country_event = { id = wsgranking.2004 } # notification
            }
        }
	}

    # 击破者为普通帝国的选项
	option = { 
        trigger = { 
                NOR = {
                has_authority = auth_warshipgirls
                has_authority = auth_shenhai
            }
        }
		name = EXCELLENT
        # 干掉的奖励
		add_resource = {
			energy = 4000
			minerals = 4000
            #sr_pantsu = 200
		}
		hidden_effect = {
			country_event = { id = wsgranking.2022 days = 10 random = 10 }
		}
	}

    # 击破者为舰娘的选项
    option = {
        trigger = { OR = {
            has_authority = auth_warshipgirls
            has_authority = auth_shenhai
        }}
		name = EXCELLENT
        # 干掉的奖励
		add_resource = {
			energy = 8000
			minerals = 8000
            sr_pantsu = 40000
		}
		hidden_effect = {
			country_event = { id = wsgranking.2022 days = 10 random = 10 }
		}
	}
}


country_event = {
    id = wsgranking.2002
    title = wsgranking.2002.name
    desc = wsgranking.2002.desc
    picture = GFX_evt_federation_fleet
    location = root.capital_scope

    is_triggered_only = yes

    immediate = {
        set_country_flag = asked_for_immigration
    }

    option = { 
        name = wsgranking.2002.a
    }
}

# 重建事件
country_event = {
    id = wsgranking.2003
    title = wsgranking.2003.name
    desc = wsgranking.2003.desc
    picture = GFX_evt_caravaneers
    location = root.capital_scope

    is_triggered_only = yes

    immediate = {
        set_global_flag = pantsu_shop_rebuilt
        every_country = {
            limit = { has_country_flag = asked_for_immigration }
            remove_country_flag = asked_for_immigration
        }
        capital_scope = { solar_system = {
            random_system_planet = {
                limit = { 
                    is_star = no
                    NOT = { is_same_value = PREVPREV }
                }
                #搞点舰队啥的
                create_pantsu_shop_guard_fleets = yes
            }
            save_global_event_target_as = pantsu_shop_system
        }}
        remove_global_flag = pantsu_shop_disabled
    }

    option = {
        name = OK
    }
    
}

# 商店被炸掉并跑路的事件
country_event = {
    id = wsgranking.2004
    title = wsgranking.2004.name
    desc = wsgranking.2004.desc
    picture = GFX_evt_wsg_no_video

    is_triggered_only = yes

    immediate = {
        #event_target:pantsu_shop_country = {
        #    destroy_country = yes
        #}
        country_event = { id = wsgranking.2005 }
    }

    option = {
        name = OK
    }
}

# 移除与胖次商店的所有buff
country_event = {
    id = wsgranking.2005
    hide_window = yes
    is_triggered_only = yes

    immediate = {
        remove_modifier = pantsu_shop_dark_matter_contract
        remove_modifier = pantsu_shop_dark_matter_contract_massive
        remove_modifier = pantsu_shop_zro_contract
        remove_modifier = pantsu_shop_zro_contract_massive
        remove_modifier = pantsu_shop_living_metal_contract
        remove_modifier = pantsu_shop_living_metal_contract_massive
        remove_modifier = pantsu_shop_nanites_contract
        remove_modifier = pantsu_shop_nanites_contract_massive
        remove_modifier = pantsu_shop_alpha_contract
        remove_modifier = pantsu_shop_alpha_contract_massive
        remove_modifier = pantsu_shop_se_contract
        remove_modifier = pantsu_shop_se_contract_massive

        remove_modifier = wg_modifier_primary_industry
        remove_modifier = wg_modifier_secondary_industry
        remove_modifier = wg_modifier_tertiary_industry
        remove_modifier = wg_modifier_planetary_construction
        remove_modifier = wg_modifier_decision
        remove_modifier = wg_modifier_megastructure_construction
        remove_modifier = wg_modifier_megastructure_pruduction
        remove_modifier = wg_modifier_diplomacy_hostile
        remove_modifier = wg_modifier_diplomacy_weight
        remove_modifier = wg_modifier_diplomacy_envoy
        remove_modifier = wg_modifier_diplomacy_trade
        remove_modifier = wg_modifier_station_gatherers
        remove_modifier = wg_modifier_survey
        remove_modifier = wg_modifier_ship_repair
        remove_modifier = wg_modifier_ship_speed
        remove_modifier = wg_modifier_combat_elite_pilot
        remove_modifier = wg_modifier_combat_hull_algorithm
        remove_modifier = wg_modifier_combat_shipcraft
        remove_modifier = wg_modifier_weapon_payment
    }
}
##########################################################
#购买大可汗的椅子
event = {
    id = wsgranking.2010
    hide_window = yes
    is_triggered_only = yes

    trigger = {
        has_global_flag = great_khan_dead
        NOR = { 
            has_global_flag = triggered_wsgranking2010
            has_global_flag = pantsu_shop_disabled 
        }
        exists = event_target:pantsu_shop_country
    }

    immediate = {
        if = {
            limit = { any_country = {
                has_relic = r_khans_throne
                is_ai = no
                NOR = {
                    has_civic = civic_fanatic_purifiers
                    has_ascension_perk = ap_shenhai_silent
                    has_civic = civic_CM
                }
                has_communications = event_target:pantsu_shop_country
            }}
            random_country = {
                limit = { 
                    has_relic = r_khans_throne
                    is_ai = no
                    NOR = {
                        has_civic = civic_fanatic_purifiers
                        has_ascension_perk = ap_shenhai_silent
                        has_civic = civic_CM
                    }
                    has_communications = event_target:pantsu_shop_country
                }
                set_global_flag = triggered_wsgranking2010
                country_event = { id = wsgranking.20110 }
            }
        }
    }
}

country_event = {
	id = wsgranking.20110
	title = pantsu_shop_name
	custom_gui = "enclave_caravaneer_window"
	desc = wsgranking.20110.desc
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		room = Ella_room
	}
	option = {
		name = wsgranking.20110.a
		change_variable = { which = rankpts value = 1 }
		save_global_event_target_as = Khans_throne_owner 
		custom_gui = "enclave_caravaneer_option"
		hidden_effect = {
			country_event = { id = wsgranking.2011 }
		}
	}
}
#第一阶段议价
country_event = {
	id = wsgranking.2011
	title = pantsu_shop_name
	custom_gui = "enclave_caravaneer_window"
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		room = Ella_room
	}
	desc = {
        # 普通帝国
        text = wsgranking.2011.desc
        trigger = {
			NOT = {
				has_country_flag = pantsu_shop_origin
			}
		}
    }
	desc = {
        # 普通帝国
        text = wsgranking.2011_1.desc
        trigger = {
			has_country_flag = pantsu_shop_origin
		}
    }
	option = {#卖了
		name = wsgranking.2011.a
		change_variable = { which = rankpts value = 2 }
		trigger = {
			NOT = {
				has_country_flag = pantsu_shop_origin
			}
		}
		custom_tooltip = wsgranking.2011.tooltip
		add_resource = {
            sr_pantsu = 200
            energy = 2000
        }
		hidden_effect = {
			event_target:pantsu_shop_country = {
				steal_relic = {
					relic = r_khans_throne
					target = event_target:Khans_throne_owner
				}	
			}
			set_global_flag = goooooooooood_chair
		}
		custom_gui = "enclave_caravaneer_option"
	}
	option = {#讨价还价LV1
		name = wsgranking.2011.b
		custom_gui = "enclave_caravaneer_option"
		trigger = {
			NOT = {
				has_country_flag = pantsu_shop_origin
			}
		}
		hidden_effect = {
			random_list = {
                10 = {
                    country_event = { id = wsgranking.2012 }#还价失败
                }
                90 = {
                    country_event = { id = wsgranking.2013 }#还价成功
                }
            }
		}
	}
	option = {#不卖
		name = wsgranking.2011.c
		response_text = wsgranking.2011.c.response
		trigger = {
			NOT = {
				has_country_flag = pantsu_shop_origin
			}
		}
		custom_gui = "enclave_caravaneer_option"
		hidden_effect = {
			random_list = {
                60 = {
                    country_event = { id = wsgranking.2020 days = 10 random = 10 }#偷椅子成功
                }
                40 = {
                    country_event = { id = wsgranking.2021 days = 10 random = 10 }#偷椅子失败
                }
            }
		}
	}
	option = {#卖了
		name = wsgranking.2011.e
		change_variable = { which = rankpts value = 5 }
		trigger = {
			has_country_flag = pantsu_shop_origin
		}
		custom_tooltip = wsgranking.2011.tooltip
		add_resource = {
            sr_pantsu = 400
            energy = 4000
        }
		hidden_effect = {
			event_target:pantsu_shop_country = {
				steal_relic = {
					relic = r_khans_throne
					target = event_target:Khans_throne_owner
				}	
			}
			set_global_flag = goooooooooood_chair
		}
		custom_gui = "enclave_caravaneer_option"
	}
	option = {#不卖
		name = wsgranking.2011.f
		trigger = {
			has_country_flag = pantsu_shop_origin
		}
		allow = {
            resource_stockpile_compare = { resource = energy value >= 538724194 }
        }
		custom_gui = "enclave_caravaneer_option"
	}
}
#一阶段还价失败
country_event = {
	id = wsgranking.2012
	title = pantsu_shop_name
	custom_gui = "enclave_caravaneer_window"
	desc = wsgranking.2012.desc
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		room = Ella_room
	}
	option = {#卖了
		name = wsgranking.2012.a
		custom_tooltip = wsgranking.2011.tooltip
		add_resource = {
            sr_pantsu = 200
            energy = 2000
        }
		hidden_effect = {
			event_target:pantsu_shop_country = {
				steal_relic = {
					relic = r_khans_throne
					target = event_target:Khans_throne_owner
				}	
			}
			set_global_flag = goooooooooood_chair
		}
		custom_gui = "enclave_caravaneer_option"
	}
	option = {#不卖
		name = wsgranking.2011.c
		response_text = wsgranking.2011.c.response
		custom_gui = "enclave_caravaneer_option"
		hidden_effect = {
			random_list = {
                60 = {
                    country_event = { id = wsgranking.2020 days = 10 random = 10 }#偷椅子成功
                }
                40 = {
                    country_event = { id = wsgranking.2021 days = 10 random = 10 }#偷椅子失败
                }
            }
		}
	}
}
#第二阶段议价
country_event = {
	id = wsgranking.2013
	title = pantsu_shop_name
	custom_gui = "enclave_caravaneer_window"
	desc = wsgranking.2013.desc
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		room = Ella_room
	}
	option = {#卖了
		name = wsgranking.2011.a
		custom_tooltip = wsgranking.2011.tooltip
		add_resource = {
            sr_pantsu = 300
            energy = 3000
        }
		hidden_effect = {
			event_target:pantsu_shop_country = {
				steal_relic = {
					relic = r_khans_throne
					target = event_target:Khans_throne_owner
				}	
			}
			set_global_flag = goooooooooood_chair
		}
		custom_gui = "enclave_caravaneer_option"
	}
	option = {#讨价还价LV1
		name = wsgranking.2013.b
		custom_gui = "enclave_caravaneer_option"
		hidden_effect = {
			random_list = {
                30 = {
                    country_event = { id = wsgranking.2014 }#还价失败
                }
                70 = {
                    country_event = { id = wsgranking.2015 }#还价成功
                }
            }
		}
	}
	option = {#不卖
		name = wsgranking.2011.c
		response_text = wsgranking.2011.c.response
		custom_gui = "enclave_caravaneer_option"
		hidden_effect = {
			random_list = {
                60 = {
                    country_event = { id = wsgranking.2020 days = 10 random = 10 }#偷椅子成功
                }
                40 = {
                    country_event = { id = wsgranking.2021 days = 10 random = 10 }#偷椅子失败
                }
            }
		}
	}
}
#二阶段还价失败
country_event = {
	id = wsgranking.2014
	title = pantsu_shop_name
	custom_gui = "enclave_caravaneer_window"
	desc = wsgranking.2012.desc
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		room = Ella_room
	}
	option = {#卖了
		name = wsgranking.2012.a
		custom_tooltip = wsgranking.2011.tooltip
		add_resource = {
            sr_pantsu = 300
            energy = 3000
        }
		hidden_effect = {
			event_target:pantsu_shop_country = {
				steal_relic = {
					relic = r_khans_throne
					target = event_target:Khans_throne_owner
				}	
			}
			set_global_flag = goooooooooood_chair
		}
		custom_gui = "enclave_caravaneer_option"
	}
	option = {#不卖
		name = wsgranking.2011.c
		response_text = wsgranking.2011.c.response
		custom_gui = "enclave_caravaneer_option"
		hidden_effect = {
			random_list = {
                60 = {
                    country_event = { id = wsgranking.2020 days = 10 random = 10 }#偷椅子成功
                }
                40 = {
                    country_event = { id = wsgranking.2021 days = 10 random = 10 }#偷椅子失败
                }
            }
		}
	}
}

#第三阶段议价
country_event = {
	id = wsgranking.2015
	title = pantsu_shop_name
	custom_gui = "enclave_caravaneer_window"
	desc = wsgranking.2015.desc
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		room = Ella_room
	}
	option = {#卖了
		name = wsgranking.2011.a
		custom_tooltip = wsgranking.2011.tooltip
		add_resource = {
            sr_pantsu = 500
			alloys = 500
            energy = 5000
        }
		hidden_effect = {
			event_target:pantsu_shop_country = {
				steal_relic = {
					relic = r_khans_throne
					target = event_target:Khans_throne_owner
				}	
			}
			set_global_flag = goooooooooood_chair
		}
		custom_gui = "enclave_caravaneer_option"
	}
	option = {#讨价还价LV3
		name = wsgranking.2015.b
		custom_gui = "enclave_caravaneer_option"
		hidden_effect = {
			random_list = {
                60 = {
                    country_event = { id = wsgranking.2016 }#还价失败
                }
                40 = {
                    country_event = { id = wsgranking.2017 }#还价成功
                }
            }
		}
	}
	option = {#不卖
		name = wsgranking.2011.c
		response_text = wsgranking.2011.c.response
		custom_gui = "enclave_caravaneer_option"
		hidden_effect = {
			random_list = {
                60 = {
                    country_event = { id = wsgranking.2020 days = 10 random = 10 }#偷椅子成功
                }
                40 = {
                    country_event = { id = wsgranking.2021 days = 10 random = 10 }#偷椅子失败
                }
            }
		}
	}
}

#三阶段还价失败
country_event = {
	id = wsgranking.2016
	title = pantsu_shop_name
	custom_gui = "enclave_caravaneer_window"
	desc = wsgranking.2012.desc
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		room = Ella_room
	}
	option = {#卖了
		name = wsgranking.2012.a
		custom_tooltip = wsgranking.2011.tooltip
		add_resource = {
            sr_pantsu = 500
			alloys = 500
            energy = 5000
        }
		hidden_effect = {
			event_target:pantsu_shop_country = {
				steal_relic = {
					relic = r_khans_throne
					target = event_target:Khans_throne_owner
				}	
			}
			set_global_flag = goooooooooood_chair
		}
		custom_gui = "enclave_caravaneer_option"
	}
	option = {#不卖
		name = wsgranking.2011.c
		response_text = wsgranking.2011.c.response
		custom_gui = "enclave_caravaneer_option"
		hidden_effect = {
			random_list = {
                60 = {
                    country_event = { id = wsgranking.2020 days = 10 random = 10 }#偷椅子成功
                }
                40 = {
                    country_event = { id = wsgranking.2021 days = 10 random = 10 }#偷椅子失败
                }
            }
		}
	}
}

#第四阶段议价
country_event = {
	id = wsgranking.2017
	title = pantsu_shop_name
	custom_gui = "enclave_caravaneer_window"
	desc = wsgranking.2017.desc
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		room = Ella_room
	}
	option = {#卖了
		name = wsgranking.2011.a
		custom_tooltip = wsgranking.2011.tooltip
		add_resource = {
            sr_pantsu = 1000
			alloys = 1000
            energy = 10000
        }
		hidden_effect = {
			event_target:pantsu_shop_country = {
				steal_relic = {
					relic = r_khans_throne
					target = event_target:Khans_throne_owner
				}	
			}
			set_global_flag = goooooooooood_chair
		}
		custom_gui = "enclave_caravaneer_option"
	}
	option = {#讨价还价LV4
		name = wsgranking.2017.b
		custom_gui = "enclave_caravaneer_option"
		hidden_effect = {
			random_list = {
                80 = {
                    country_event = { id = wsgranking.2018 }#还价失败
                }
                20 = {
                    country_event = { id = wsgranking.2019 }#还价成功
                }
            }
		}
	}
	option = {#不卖
		name = wsgranking.2011.c
		response_text = wsgranking.2011.c.response
		custom_gui = "enclave_caravaneer_option"
		hidden_effect = {
			random_list = {
                60 = {
                    country_event = { id = wsgranking.2020 days = 10 random = 10 }#偷椅子成功
                }
                40 = {
                    country_event = { id = wsgranking.2021 days = 10 random = 10 }#偷椅子失败
                }
            }
		}
	}
}

#四阶段还价失败
country_event = {
	id = wsgranking.2018
	title = pantsu_shop_name
	custom_gui = "enclave_caravaneer_window"
	desc = wsgranking.2012.desc
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		room = Ella_room
	}
	option = {#卖了
		name = wsgranking.2012.a
		custom_tooltip = wsgranking.2011.tooltip
		add_resource = {
            sr_pantsu = 1000
			alloys = 1000
            energy = 10000
        }
		hidden_effect = {
			event_target:pantsu_shop_country = {
				steal_relic = {
					relic = r_khans_throne
					target = event_target:Khans_throne_owner
				}	
			}
			set_global_flag = goooooooooood_chair
		}
		custom_gui = "enclave_caravaneer_option"
	}
	option = {#不卖
		name = wsgranking.2011.c
		response_text = wsgranking.2011.c.response
		custom_gui = "enclave_caravaneer_option"
		hidden_effect = {
			random_list = {
                60 = {
                    country_event = { id = wsgranking.2020 days = 10 random = 10 }#偷椅子成功
                }
                40 = {
                    country_event = { id = wsgranking.2021 days = 10 random = 10 }#偷椅子失败
                }
            }
		}
	}
}

#第五阶段
country_event = {
	id = wsgranking.2019
	title = pantsu_shop_name
	custom_gui = "enclave_caravaneer_window"
	desc = wsgranking.2019.desc
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		room = Ella_room
	}
	option = {#卖了
		name = wsgranking.2011.a
		custom_tooltip = wsgranking.2011.tooltip
		add_resource = {
			sr_dark_matter = 1000
            sr_pantsu = 2000
			alloys = 2000
            energy = 20000
        }
		hidden_effect = {
			event_target:pantsu_shop_country = {
				steal_relic = {
					relic = r_khans_throne
					target = event_target:Khans_throne_owner
				}	
			}
		}
		custom_gui = "enclave_caravaneer_option"
	}
	option = {#不卖
		name = wsgranking.2011.c
		response_text = wsgranking.2011.c.response
		custom_gui = "enclave_caravaneer_option"
		hidden_effect = {
			random_list = {
                60 = {
                    country_event = { id = wsgranking.2020 days = 10 random = 10 }#偷椅子成功
                }
                40 = {
                    country_event = { id = wsgranking.2021 days = 10 random = 10 }#偷椅子失败
                }
            }
		}
	}
}
#偷椅子成功
country_event = {
    id = wsgranking.2020
    title = wsgranking.2020.name
    desc = wsgranking.2020.desc
    picture = GFX_evt_wg_ella_khans_throne

    is_triggered_only = yes


    option = {
        name = wsgranking.2020.a
		change_variable = { which = rankpts value = 2 }
		set_global_flag = goooooooooood_chair
		set_country_flag = chair_victim
		event_target:pantsu_shop_country = {
			steal_relic = {
				relic = r_khans_throne
				target = event_target:Khans_throne_owner
			}	
		}
    }
}
#偷椅子失败
country_event = {
    id = wsgranking.2021
    title = wsgranking.2021.name
    desc = wsgranking.2021.desc
    picture = GFX_evt_archaeology_trap

    is_triggered_only = yes


    option = {
        name = wsgranking.2021.a
		change_variable = { which = rankpts value = 5 }
    }
}
#重新找回椅子
country_event = {
    id = wsgranking.2022
    title = wsgranking.2022.name
    picture = GFX_evt_space_walk
	desc = {
        text = wsgranking.2022.desc_01
        trigger = {
			NOT = {
				has_country_flag = chair_victim
			}
		}
    }
	desc = {
        text = wsgranking.2022.desc_02
        trigger = {
			has_country_flag = chair_victim
		}
    }
    is_triggered_only = yes
    trigger = {
		has_global_flag = goooooooooood_chair
	}

    option = {
		name = wsgranking.2022.a
		owner = { add_relic = "r_eila_throne" }
	}
}
#########################################食堂
country_event = {
	id = wsgranking.2030
	title = pantsu_shop_canteen_name
	custom_gui = "enclave_caravaneer_window"
	desc = wsgranking.2030.desc
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		room = Canteen_room
	}
	trigger = {
		NOT = { has_country_flag = engaged_with_canteen }
        NOT = { has_global_flag = pantsu_shop_disabled }
	}
	immediate = {
        set_timed_country_flag = { flag = engaged_with_canteen days = 180 }
    }
	option = {#吃
		name = wsgranking.2030.a
		custom_tooltip = wsgranking.2030.tooltip
		custom_gui = "enclave_caravaneer_option"
		hidden_effect = {
			random_list = { 
				10 = {
					modifier = {
						factor = 0
						has_country_flag = wg_canteen1
					}
					country_event = { id = wsgranking.2031 days = 1 }
				}
				10 = {
					modifier = {
						factor = 0
						has_country_flag = wg_canteen2
					}
					country_event = { id = wsgranking.2032 days = 1 } 
				}
				10 = {
					modifier = {
						factor = 0
						has_country_flag = wg_canteen3
					}
					country_event = { id = wsgranking.2033 days = 1 } 
				}
				10 = {
					modifier = {
						factor = 0
						has_country_flag = wg_canteen4
					}
					country_event = { id = wsgranking.2034 days = 1 } 
				}
				10 = {
					modifier = {
						factor = 0
						has_country_flag = wg_canteen5
					}
					country_event = { id = wsgranking.2035 days = 1 } 
				}
				10 = {
					modifier = {
						factor = 0
						has_country_flag = wg_canteen6
					}
					country_event = { id = wsgranking.2036 days = 1 } 
				}
				10 = {
					modifier = {
						factor = 0
						has_country_flag = wg_canteen7
					}
					country_event = { id = wsgranking.2037 days = 1 } 
				}
				10 = {
					modifier = {
						factor = 0
						has_country_flag = wg_canteen8
					}
					country_event = { id = wsgranking.2038 days = 1 } 
				}
				10 = {
					modifier = {
						factor = 0
						has_country_flag = wg_canteen9
					}
					country_event = { id = wsgranking.2039 days = 1 } 
				}
				10 = {
					modifier = {
						factor = 0
						has_country_flag = wg_canteen10
					}
					country_event = { id = wsgranking.2040 days = 1 } 
				}
				10 = {
					modifier = {
						factor = 0
						has_country_flag = wg_canteen11
					}
					country_event = { id = wsgranking.2041 days = 1 } 
				}
				10 = {
					modifier = {
						factor = 0
						has_country_flag = wg_canteen12
					}
					country_event = { id = wsgranking.2042 days = 1 } 
				}
				10 = {
					modifier = {
						factor = 0
						has_country_flag = wg_canteen13
					}
					modifier = {
						factor = 0
						NOT = { has_global_flag = wg_boss_bugv_created }
					}
					country_event = { id = wsgranking.2043 days = 1 } 
				}
				10 = {
					modifier = {
						factor = 0
						has_country_flag = wg_canteen14
					}
					country_event = { id = wsgranking.2044 days = 1 } 
				}
				10 = {
					modifier = {
						factor = 0
						has_country_flag = wg_canteen15
					}
					country_event = { id = wsgranking.2045 days = 1 } 
				}
				10 = {
					modifier = {
						factor = 0
						has_country_flag = wg_canteen16
					}
					modifier = {
						factor = 0
						resource_stockpile_compare = { resource = energy value < 500 }
					}
					country_event = { id = wsgranking.2046 days = 5 } 
                }
                10 = {
					modifier = {
						factor = 0
						has_modifier = wg_modifier_canteen_affectionUp1
					}
					country_event = { id = wsgranking.2047 days = 1 } 
                }
                10 = { #要是有人这么欧连抽两次中两个buff当我倒霉
					modifier = {
						factor = 0
						has_modifier = wg_modifier_canteen_affectionUp2
					}
					country_event = { id = wsgranking.2048 days = 1 } 
				}
			}	
		}
	}
	option = {#吃啥
		name = wsgranking.2030.b
		custom_gui = "enclave_caravaneer_option"
		response_text = wsgranking.2030.b.response
		is_dialog_only = yes
	}
	option = {#不吃了
		name = wsgranking.2030.c
		custom_gui = "enclave_caravaneer_option"
	}
}

country_event = {
    id = wsgranking.2031
    title = wsgranking.2031.name
    desc = wsgranking.2031.desc
    picture = GFX_evt_wg_Chinesefood

    is_triggered_only = yes


    option = {
        name = wsgranking.2031.a
		set_timed_country_flag = { flag = wg_canteen1 days = 1800 }
		add_modifier = {
			modifier = wg_modifier_canteen1
			days = 1800
		}
    }
}
country_event = {
    id = wsgranking.2032
    title = wsgranking.2032.name
    desc = wsgranking.2032.desc
    picture = GFX_evt_wg_Chinesefood

    is_triggered_only = yes


    option = {
        name = wsgranking.2032.a
		set_timed_country_flag = { flag = wg_canteen2 days = 1800 }
		add_modifier = {
			modifier = wg_modifier_canteen2
			days = 1800
		}
    }
}

country_event = {
    id = wsgranking.2033
    title = wsgranking.2033.name
    desc = wsgranking.2033.desc
    picture = GFX_evt_wg_Chinesefood

    is_triggered_only = yes


    option = {
        name = wsgranking.2033.a
		set_timed_country_flag = { flag = wg_canteen3 days = 1800 }
		add_modifier = {
			modifier = wg_modifier_canteen3
			days = 1800
		}
    }
}
country_event = {
    id = wsgranking.2034
    title = wsgranking.2034.name
    desc = wsgranking.2034.desc
    picture = GFX_evt_wg_Britishfood

    is_triggered_only = yes


    option = {
        name = wsgranking.2034.a
		set_timed_country_flag = { flag = wg_canteen4 days = 1800 }
		add_modifier = {
			modifier = wg_modifier_canteen4
			days = 1800
		}
    }
}

country_event = {
    id = wsgranking.2035
    title = wsgranking.2035.name
    desc = wsgranking.2035.desc
    picture = GFX_evt_wg_Chinesefood

    is_triggered_only = yes


    option = {
        name = wsgranking.2035.a
		set_timed_country_flag = { flag = wg_canteen5 days = 1800 }
		add_modifier = {
			modifier = wg_modifier_canteen5
			days = 1800
		}
    }
}

country_event = {
    id = wsgranking.2036
    title = wsgranking.2036.name
    desc = wsgranking.2036.desc
    picture = GFX_evt_wg_Britishfood

    is_triggered_only = yes


    option = {
        name = wsgranking.2036.a
		set_timed_country_flag = { flag = wg_canteen6 days = 1800 }
		add_modifier = {
			modifier = wg_modifier_canteen6
			days = 1800
		}
    }
}

country_event = {
    id = wsgranking.2037
    title = wsgranking.2037.name
    desc = wsgranking.2037.desc
    picture = GFX_evt_wg_Britishfood

    is_triggered_only = yes


    option = {
        name = wsgranking.2037.a
		set_timed_country_flag = { flag = wg_canteen7 days = 1800 }
		add_modifier = {
			modifier = wg_modifier_canteen7
			days = 1800
		}
    }
}

country_event = {
    id = wsgranking.2038
    title = wsgranking.2038.name
    desc = wsgranking.2038.desc
    picture = GFX_evt_wg_Chinesefood

    is_triggered_only = yes


    option = {
        name = wsgranking.2038.a
		set_timed_country_flag = { flag = wg_canteen8 days = 1800 }
		add_modifier = {
			modifier = wg_modifier_canteen8
			days = 1800
		}
    }
}

country_event = {
    id = wsgranking.2039
    title = wsgranking.2039.name
    desc = wsgranking.2039.desc
    picture = GFX_evt_wg_Chinesefood

    is_triggered_only = yes
	immediate = {
		random_owned_leader = {
			limit = { 
				leader_class = scientist 
				NOR = { 
					has_leader_flag = wg_shimakaze_scientist
					has_trait = leader_trait_spark_of_genius
				}
			}
			save_global_event_target_as = wg_canteen_scientist
		}
	}


    option = {
        name = wsgranking.2039.a
		set_country_flag = wg_canteen9
		event_target:wg_canteen_scientist = {
			add_experience = 1000
			add_trait_no_notify = leader_trait_spark_of_genius
		}
    }
}

country_event = {
    id = wsgranking.2040
    title = wsgranking.2040.name
    desc = wsgranking.2040.desc
    picture = GFX_evt_wg_Britishfood

    is_triggered_only = yes


    option = {
        name = wsgranking.2040.a
		set_timed_country_flag = { flag = wg_canteen10 days = 1800 }
		add_modifier = {
			modifier = wg_modifier_canteen10
			days = 1800
		}
    }
}

country_event = {
    id = wsgranking.2041
    title = wsgranking.2041.name
    desc = wsgranking.2041.desc
    picture = GFX_evt_wg_Britishfood

    is_triggered_only = yes


    option = {
        name = wsgranking.2041.a
		set_timed_country_flag = { flag = wg_canteen11 days = 1800 }
		add_modifier = {
			modifier = wg_modifier_canteen11
			days = 1800
		}
    }
}
country_event = {
    id = wsgranking.2042
    title = wsgranking.2042.name
    desc = wsgranking.2042.desc
    picture = GFX_evt_wg_Britishfood

    is_triggered_only = yes


    option = {
        name = wsgranking.2041.a
		set_timed_country_flag = { flag = wg_canteen12 days = 1800 }
		add_modifier = {
			modifier = wg_modifier_canteen12
			days = 1800
		}
    }
}
country_event = {
    id = wsgranking.2043
    title = wsgranking.2043.name
    desc = wsgranking.2043.desc
    picture = GFX_evt_wg_Britishfood

    is_triggered_only = yes


    option = {
        name = wsgranking.2043.a
		set_timed_country_flag = { flag = wg_canteen13 days = 1200 }
		add_modifier = {
			modifier = wg_modifier_canteen13
			days = 1200
		}
    }
}
country_event = {
    id = wsgranking.2044
    title = wsgranking.2044.name
    desc = wsgranking.2044.desc
    picture = GFX_evt_wg_Chinesefood

    is_triggered_only = yes


    option = {
        name = wsgranking.2044.a
		set_timed_country_flag = { flag = wg_canteen14 days = 1800 }
		add_modifier = {
			modifier = wg_modifier_canteen14
			days = 1800
		}
    }
}
country_event = {
    id = wsgranking.2045
    title = wsgranking.2045.name
    desc = wsgranking.2045.desc
    picture = GFX_evt_wg_Chinesefood

    is_triggered_only = yes


    option = {
        name = wsgranking.2045.a
		set_timed_country_flag = { flag = wg_canteen15 days = 1800 }
		add_modifier = {
			modifier = wg_modifier_canteen15
			days = 1800
		}
    }
}

country_event = {
    id = wsgranking.2046
    title = wsgranking.2046.name
    desc = wsgranking.2046.desc
    picture = GFX_evt_wg_Britishfood

    is_triggered_only = yes


    option = {
        name = wsgranking.2046.a
		set_country_flag = wg_canteen16
		add_resource = { energy = -500 }
    }
}

country_event = {
    id = wsgranking.2047
    title = wsgranking.2047.name
    desc = wsgranking.2047.desc
    picture = GFX_evt_wg_Chinesefood

    is_triggered_only = yes


    option = {
        name = wsgranking.2047.a
		add_modifier = {
			modifier = wg_modifier_canteen_affectionUp1
			days = 1800
		}
    }
}

country_event = {
    id = wsgranking.2048
    title = wsgranking.2048.name
    desc = wsgranking.2048.desc
    picture = GFX_evt_wg_Chinesefood

    is_triggered_only = yes


    option = {
        name = wsgranking.2048.a
		add_modifier = {
			modifier = wg_modifier_canteen_affectionUp2
			days = 1800
		}
    }
}
#################################卖LOGO泰坦
# 打开商店的主界面
country_event = {
	id = wsgranking.2100
	title = pantsu_shop_name
    custom_gui = "enclave_caravaneer_window"
    trigger = {
        OR = {
            has_authority = auth_shenhai
            has_authority = auth_warshipgirls
        }
        exists = event_target:pantsu_shop_country
		has_communications = event_target:pantsu_shop_country
        event_target:pantsu_shop_country = {
            NOT = { is_hostile = root }
        }
        OR = { 
            #防止视窗多开
            NOT = { has_country_flag = engaged_with_pantsu_shop2 }
		}
        from = { OR = {
            is_country_type = pantsu_shop_logo_titan
            is_same_value = root # returned from menu
        }}
        is_ai = no
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

	desc = { text = pantsu_shop_logotitan }

    diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
		room = Ella_room
    }
    
    immediate = {
        set_country_flag = engaged_with_pantsu_shop2
    }

    # 瞎扯淡
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.2100.a
        response_text = wsgranking.2100.a.response
        is_dialog_only = yes
    }

    # 我买了
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.2100.b
		allow = {
            resource_stockpile_compare = { resource = energy value >= 10000 }
            resource_stockpile_compare = { resource = sr_pantsu value >= 3000 }
        }
		add_resource = {
            sr_pantsu = -3000
            energy = -10000
        }
		change_variable = { which = rankpts value = 5 }
        hidden_effect = {
			country_event = { id = wsgranking.2101 }
        }
    }

    # 退出
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.2100.c
        default_hide_option = yes
        remove_country_flag = engaged_with_pantsu_shop2
    }
}

country_event = {
	id = wsgranking.2101
	title = pantsu_shop_name
    custom_gui = "enclave_caravaneer_window"
	desc = { text = pantsu_shop_logotitan2 }

    diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
		room = Ella_room
    }
	immediate = {
        random_country = {
			limit = { is_country_type = pantsu_shop_logo_titan }
            random_owned_fleet = {
                limit = { has_fleet_flag = logo_titan_fleet }
                delete_fleet = this
			}
			destroy_country = yes
		}	
    }

    # 巨企logo
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.2101.a
		hidden_effect = {
            create_fleet = {
			    name = "NAME_WG_LOGO_TITAN_2"
			    effect = {
				    set_owner = root
				    create_ship = {
					    name = random
					    design = "NAME_WG_LOGO_TITAN_2"
						graphical_culture = "mammalian_01"
					    upgradable = no
				    }
				    set_location = {
					    target = root.capital_scope
					    distance = 30
					    angle = random
				    }
			    }
			}
		}
    }
    # 红星
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.2101.b
		hidden_effect = {
            create_fleet = {
			    name = "NAME_WG_LOGO_TITAN_1"
			    effect = {
				    set_owner = root
				    create_ship = {
					    name = random
					    design = "NAME_WG_LOGO_TITAN_1"
						graphical_culture = "mammalian_01"
					    upgradable = no
				    }
				    set_location = {
					    target = root.capital_scope
					    distance = 30
					    angle = random
				    }
			    }
			}
		}
    }
	#滑稽
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.2101.c
		hidden_effect = {
            create_fleet = {
			    name = "NAME_WG_LOGO_TITAN_3"
			    effect = {
				    set_owner = root
				    create_ship = {
					    name = random
					    design = "NAME_WG_LOGO_TITAN_3"
						graphical_culture = "mammalian_01"
					    upgradable = no
				    }
				    set_location = {
					    target = root.capital_scope
					    distance = 30
					    angle = random
				    }
			    }
			}
		}
    }
	#大主教
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.2101.d
		hidden_effect = {
            create_fleet = {
			    name = "NAME_WG_LOGO_TITAN_4"
			    effect = {
				    set_owner = root
				    create_ship = {
					    name = random
					    design = "NAME_WG_LOGO_TITAN_4"
						graphical_culture = "mammalian_01"
					    upgradable = no
				    }
				    set_location = {
					    target = root.capital_scope
					    distance = 30
					    angle = random
				    }
			    }
			}
		}
    }
	#非洲星
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.2101.e
		hidden_effect = {
            create_fleet = {
			    name = "NAME_WG_LOGO_TITAN_5"
			    effect = {
				    set_owner = root
				    create_ship = {
					    name = random
					    design = "NAME_WG_LOGO_TITAN_5"
						graphical_culture = "mammalian_01"
					    upgradable = no
				    }
				    set_location = {
					    target = root.capital_scope
					    distance = 30
					    angle = random
				    }
			    }
			}
		}
    }
	#KDC
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.2101.f
		hidden_effect = {
            create_fleet = {
			    name = "NAME_WG_LOGO_TITAN_6"
			    effect = {
				    set_owner = root
				    create_ship = {
					    name = random
					    design = "NAME_WG_LOGO_TITAN_6"
						graphical_culture = "mammalian_01"
					    upgradable = no
				    }
				    set_location = {
					    target = root.capital_scope
					    distance = 30
					    angle = random
				    }
			    }
			}
		}
    }
}

country_event = {
	id = wsgranking.2102
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		change_variable = {
			which = max_allowed_shop_buffs
			value = 1
		}
	}
}

country_event = {
	id = wsgranking.2103
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		change_variable = {
			which = max_allowed_shop_buffs
			value = 1
		}
	}
}


# 戒指建筑
planet_event = {
	id = wsgranking.2104
	title = wsgranking.2104.name
    desc = wsgranking.2104.desc
    picture = GFX_evt_wsg_rank2

    is_triggered_only = yes
    trigger = {
        owner = { NOT = { has_country_flag = built_cunningmazon }}
    }
    immediate = {
        owner = { set_country_flag = built_cunningmazon }
    }

    option = {
        name = wsgranking.2104.a
        hidden_effect = {
            owner = { 
                country_event = { id = wsgranking.2106 days = 1800 }
            }
        }
    }
}

# 戒指通知
country_event = {
	id = wsgranking.2105
	title = wsgranking.2105.name
    desc = wsgranking.2105.desc
    picture = GFX_evt_wsg_rank2

    is_triggered_only = yes
    trigger = {
        NOT = { 
            has_country_flag = ban_ring_notice
        }
    }
    option = {
        name = wsgranking.2105.a
    }
	option = {
        name = wsgranking.2105.b
        set_country_flag = ban_ring_notice
    }
}

country_event = {
	id = wsgranking.2106
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		change_variable = { which = "wsg_rings" value = 1 }
        country_event = { id = wsgranking.2105 days = 1800 }
		country_event = { id = wsgranking.2106 days = 1800 }
	}
}

###################################################

#科技触发上限增长
country_event = {
	id = wsgranking.8001
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	trigger = {
		last_increased_tech = tech_wg_buff_1
	}
	immediate = {
		change_variable = {
			which = max_allowed_shop_buffs
			value = 1
		}
	}
}

country_event = {
	id = wsgranking.8002
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	trigger = {
		last_increased_tech = tech_wg_buff_2
	}
	immediate = {
		change_variable = {
			which = max_allowed_shop_buffs
			value = 1
		}
	}
}

# #wg_modifier_tertiary_industry
#紧急战斗植入物
country_event = {
	id = wsgranking.9000
	title = "TRANSMISSION"
	custom_gui = "enclave_caravaneer_window"
	desc = wsgranking.9000.desc
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		room = Shop_room
	}
	fire_only_once = yes
    trigger = {
        NOT = { has_global_flag = pantsu_shop_disabled }
    }
	option = {
		custom_gui = "enclave_caravaneer_option"
		name = wg_shop_celebration
		add_modifier = {
			modifier = wg_modifier_implant_coordination
			days = -1
		}
		every_owned_leader = {
			switch = {
				trigger = leader_class
				admiral = {
					add_skill = 3
					#add_trait_no_notify = leader_trait_inferior_implant
				}
			}
		}
		random_owned_leader = {
			limit = {
				is_same_species = owner.species
				leader_class = commander
                NOT = { is_ruler = yes }
			}
			add_trait_no_notify = leader_trait_ascension_implant
		}
	}
}

#便携式舰队CIC
country_event = {
	id = wsgranking.9001
	title = pantsu_shop_name
	custom_gui = "enclave_caravaneer_window"
	desc = wsgranking.9001.desc
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		room = Ella_room
	}
    trigger = {
        NOT = { has_global_flag = pantsu_shop_disabled }
    }
	fire_only_once = yes
	option = {
		name = wg_shop_celebration
		custom_gui = "enclave_caravaneer_option"
		add_modifier = {
			modifier = wg_modifier_combat_fleet_control
			days = -1
		}
	}
}

country_event = {
	id = wsgranking.9002
	title = pantsu_shop_name
	custom_gui = "enclave_caravaneer_window"
	desc = wsgranking.9002.desc
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		room = Ella_room
	}
    trigger = {
        NOT = { has_global_flag = pantsu_shop_disabled }
    }
	fire_only_once = yes
	option = {
		name = wg_shop_celebration
		custom_gui = "enclave_caravaneer_option"
		add_modifier = {
			modifier = wg_modifier_combat_uf
			days = -1
		}
	}
}

country_event = {
	id = wsgranking.9003
	title = pantsu_shop_name
	custom_gui = "enclave_caravaneer_window"
	desc = wsgranking.9003.desc
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		room = Ella_room
	}
    trigger = {
        NOT = { has_global_flag = pantsu_shop_disabled }
    }
	fire_only_once = yes
	option = {
        trigger = {
            has_authority = auth_warshipgirls    
        }
		name = wg_shop_celebration
		custom_gui = "enclave_caravaneer_option"
        add_research_option = tech_wsg_dmm
        add_research_option = tech_wsg_mine
        add_tech_progress = {
            tech = tech_wsg_dmm
            progress = 0.5
        }
        
    }
    option = {
        trigger = {
            has_authority = auth_shenhai    
        }
		name = wg_shop_celebration
		custom_gui = "enclave_caravaneer_option"
        add_research_option = tech_wsg_mine
        add_tech_progress = {
            tech = tech_wsg_mine
            progress = 0.5
        }
    }
}

country_event = {
	id = wsgranking.9005
	title = pantsu_shop_name
	custom_gui = "enclave_caravaneer_window"
	desc = wsgranking.9005.desc
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		room = Ella_room
	}
    trigger = {
        NOT = { has_global_flag = pantsu_shop_disabled }
    }
	option = {
        custom_gui = "enclave_caravaneer_option"
		name = wsgranking.9005.a
        custom_tooltip = "wsgranking.9005.effect"
		hidden_effect = {
            country_event = { id = wsgranking.9006 }
        }
	}
}

country_event = {
	id = wsgranking.9006
	title = pantsu_shop_name
	custom_gui = "enclave_caravaneer_window"
	desc = wsgranking.9006.desc
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		room = Ella_room
    }
    trigger = {
        NOT = { has_global_flag = pantsu_shop_disabled }
    }
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = "implant_request_desc"
        response_text = "implant_request_desc_response"
        trigger = {
            NOT = { 
                has_country_flag = implant_purchased
            }
            #has_country_flag = wg_invasion_happened
        }
        allow = {
            resource_stockpile_compare = { resource = sr_pantsu value >= 5000 }
            resource_stockpile_compare = { resource = energy value >= 20000 }
            custom_tooltip = {
                fail_text = too_low_rank_fail_250
                check_variable = { which = "rankpts" value >= 250 }
            }
        }
        add_resource = {
            sr_pantsu = -5000
            energy = -20000
        }
        add_modifier = {
            modifier = wg_modifier_ultimate_project
            days = 360
        }
        set_country_flag = implant_purchased
        hidden_effect = {
            country_event = { id = wsgranking.9000 days = 360 }
            remove_country_flag = engaged_with_pantsu_shop
        }
    }

    
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = "cic_request_desc"
        response_text = "cic_request_desc_response"
        trigger = {
            NOT = { 
                has_country_flag = cic_purchased
            }
            #has_country_flag = wg_invasion_happened
        }
        allow = {
            resource_stockpile_compare = { resource = sr_pantsu value >= 5000 }
            resource_stockpile_compare = { resource = alloys value >= 30000 }
            custom_tooltip = {
                fail_text = too_low_rank_fail_250
                check_variable = { which = "rankpts" value >= 250 }
            }
        }
        add_resource = {
            sr_pantsu = -5000
            alloys = -30000
        }
        add_modifier = {
            modifier = wg_modifier_ultimate_project
            days = 360
        }
        set_country_flag = cic_purchased
        hidden_effect = {
            country_event = { id = wsgranking.9001 days = 360 }
            remove_country_flag = engaged_with_pantsu_shop
        }
    }

    option = {
        custom_gui = "enclave_caravaneer_option"
        name = "combat_uf_request_desc"
        response_text = "combat_uf_request_response"
        trigger = {
            NOT = { 
                has_country_flag = uf_shop_buff_purchased
            }
            #has_country_flag = wg_invasion_happened
        }
        allow = {
            resource_stockpile_compare = { resource = sr_pantsu value >= 5000 }
            resource_stockpile_compare = { resource = energy value >= 20000 }
            custom_tooltip = {
                fail_text = too_low_rank_fail_250
                check_variable = { which = "rankpts" value >= 250 }
            }
        }
        add_resource = {
            sr_pantsu = -5000
            energy = -20000
        }
        add_modifier = {
            modifier = wg_modifier_ultimate_project
            days = 360
        }
        set_country_flag = uf_shop_buff_purchased
        hidden_effect = {
            country_event = { id = wsgranking.9002 days = 360 }
            remove_country_flag = engaged_with_pantsu_shop
        }
    }

    option = {
        custom_gui = "enclave_caravaneer_option"
        name = "weapon_dmm_request_desc"
        response_text = "weapon_dmm_request_desc_response"
        trigger = {
			NOR = { 
                has_ascension_perk = ap_project_s
				has_country_flag = wg_weapon_dmm_requested
            }
            has_authority = auth_warshipgirls
            #has_country_flag = wg_invasion_happened
        }
        allow = {
            resource_stockpile_compare = { resource = sr_alpha value >= 5000 }
            resource_stockpile_compare = { resource = sr_dark_matter value >= 5000 }
            resource_stockpile_compare = { resource = alloys value >= 10000 }
            custom_tooltip = {
                fail_text = too_low_rank_fail_250
                check_variable = { which = "rankpts" value >= 250 }
            }
        }
        add_resource = {
            sr_alpha = -5000
            sr_dark_matter = -5000
            alloys = -10000
        }
        add_modifier = {
            modifier = wg_modifier_ultimate_project
            days = 360
        }
        set_country_flag = wg_weapon_dmm_requested
        hidden_effect = {
            country_event = { id = wsgranking.9003 days = 360 }
            remove_country_flag = engaged_with_pantsu_shop
        }
    }

    option = {
        custom_gui = "enclave_caravaneer_option"
        name = "weapon_dmm_request_desc"
        response_text = "sh_mine_request_desc_response"
        trigger = {
            NOT = { 
                has_country_flag = wg_weapon_dmm_requested
            }
			OR = {
				has_ascension_perk = ap_project_s
				has_authority = auth_shenhai
			}
            #has_country_flag = wg_invasion_happened
        }
        allow = {
            resource_stockpile_compare = { resource = sr_se value >= 5000 }
            resource_stockpile_compare = { resource = sr_dark_matter value >= 5000 }
            #resource_stockpile_compare = { resource = alloys value >= 10000 }
            custom_tooltip = {
                fail_text = too_low_rank_fail_250
                check_variable = { which = "rankpts" value >= 250 }
            }
        }
        add_resource = {
            sr_se = -5000
            sr_dark_matter = -5000
            #alloys = -10000
        }
        add_modifier = {
            modifier = wg_modifier_ultimate_project
            days = 360
        }
        set_country_flag = wg_weapon_dmm_requested
        hidden_effect = {
            country_event = { id = wsgranking.9003 days = 360 }
            remove_country_flag = engaged_with_pantsu_shop
        }
    }

    option = {
        name = pantsu_shop_exit
        custom_gui = "enclave_caravaneer_option"
        default_hide_option = yes
        remove_country_flag = engaged_with_pantsu_shop
    }
}



country_event = {
    id = wsgranking.32767
    hide_window = yes
    is_triggered_only = yes
    trigger = {
        always = no
    }
    immediate = {
        change_variable = {
            which = rankpts
            value = 300
        }
    }
}


