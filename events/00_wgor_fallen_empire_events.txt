namespace = fallen_empires

# Fallen Empire establishes communications
country_event = {
	id = fallen_empires.10
	title = OK
	desc = OK
	
	hide_window = yes
	
	mean_time_to_happen = {
		months = 3
	}

		trigger = {
		OR = {
			is_country_type = fallen_empire
			is_country_type = awakened_fallen_empire
		}
		is_at_war = no
		any_country = {
			OR = {
				is_country_type = default
				is_country_type = fallen_empire
			}
			NOT = { has_communications = root }			
			OR = {
				AND = {
					root = { has_ai_personality = fallen_empire_spiritualist }
					any_owned_planet = {
						has_modifier = "holy_planet"
					}				
				}
				AND = {
					root = { has_ai_personality = fallen_empire_materialist }
					OR = {
						has_technology = tech_sapient_ai
						has_technology = tech_synthetic_workers
					}
					any_system_within_border = {
						distance = {
							source = root.capital_scope
							max_distance <= 200				
						}
					}						
				}
				# if we're both fallen empires, we know of each other
				is_country_type = fallen_empire
				# also contact if we border them
				any_system_within_border = {
					any_neighbor_system = {
						has_hyperlane_to = prev
						is_owned_by = root
					}
				}
			}
		}
	}
	
	immediate = {
		random_country = {
			limit = {
				OR = {
					is_country_type = default
					is_country_type = fallen_empire
				}			
				NOT = { has_communications = root }				
				OR = {
					AND = {
						root = { has_ai_personality = fallen_empire_spiritualist }
						any_owned_planet = {
							has_modifier = "holy_planet"
						}						
					}					
					AND = {
						root = { has_ai_personality = fallen_empire_materialist }
						OR = {
							has_technology = tech_sapient_ai
							has_technology = tech_synthetic_workers
						}
						any_system_within_border = {
							distance = {
								source = root.capital_scope
								max_distance <= 200				
							}
						}						
					}	
					# if we're both fallen empires, we know of each other
					is_country_type = fallen_empire
					# also contact if we border them
					any_system_within_border = {
						any_neighbor_system = {
							has_hyperlane_to = prev
							is_owned_by = root
						}
					}						
				}					
			}

			establish_communications_no_message = root	
			root = { save_event_target_as = contact_empire }
			if = {
				limit = { 
					root = { is_wg_fallen_empire = yes }
					is_ai = no
					OR = {
						has_authority = auth_warshipgirls
						has_authority = auth_shenhai
					}
				}
				country_event = { id = wg_fe.2 }
			} else_if = {
				limit = { 
					root = { is_sh_fallen_empire = yes }
					is_ai = no
					OR = {
						has_authority = auth_warshipgirls
						has_authority = auth_shenhai
					}
				}
				country_event = { id = sh_fe.2 }
			} else = {
				ROOT = { save_event_target_as = contact_empire }
				country_event = { id = action.1 }
			}
						
		}
	}
}